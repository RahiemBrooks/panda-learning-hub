<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PANDA Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'panda-blue': '#1E5A8E',
                        'panda-orange': '#F5A24A',
                        'panda-light-blue': '#7DB9DE',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-25px); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="m-0 p-0">
    <div id="app" class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50"></div>

    <script>
        // ============================================================================
        // STATE MANAGEMENT
        // ============================================================================
        const state = {
            currentView: 'opening',
            userRole: null,
            consentGiven: false,
            userId: null,
            preTestCompleted: false,
            currentDay: 1,
            journalEntries: [],
            activityProgress: {},
            childProgress: { correct: 0, total: 0 },
            currentQuestion: null,
            feedback: '',
            isListening: false,
            activeTab: 'coaching',
            children: [],
            activeChildId: null,
            currentSubject: null,
            currentLesson: null,
            assessmentInProgress: false,
            assessmentType: null,
            learningData: {},
            teacherMode: true,
            voiceEnabled: false,
            currentPrompt: null,
            showHints: true
        };

        const curriculum = {
            colors: {
                name: 'Colors',
                icon: 'üé®',
                items: ['red', 'orange', 'yellow', 'green', 'blue', 'purple', 'black', 'white', 'gray', 'brown']
            },
            shapes: {
                name: 'Shapes', 
                icon: '‚¨õ',
                items: ['circle', 'square', 'rectangle', 'triangle', 'sphere', 'oval', 'star', 'heart']
            },
            letters: {
                name: 'Letters',
                icon: 'üìù',
                items: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').concat('abcdefghijklmnopqrstuvwxyz'.split(''))
            },
            numbers: {
                name: 'Numbers',
                icon: 'üî¢',
                items: Array.from({length: 20}, (_, i) => (i + 1).toString())
            },
            clothing: {
                name: 'Clothing',
                icon: 'üëï',
                items: ['shirt', 'pants', 'shoes', 'hat', 'socks', 'jacket', 'dress', 'scarf'],
                emojis: ['üëï', 'üëñ', 'üëü', 'üé©', 'üß¶', 'üß•', 'üëó', 'üß£']
            },
            household: {
                name: 'Household',
                icon: 'üè†',
                items: ['chair', 'table', 'bed', 'door', 'window', 'cup', 'spoon', 'brush'],
                emojis: ['ü™ë', 'ü™ë', 'üõèÔ∏è', 'üö™', 'ü™ü', '‚òï', 'ü•Ñ', 'ü™•']
            },
            animals: {
                name: 'Animals',
                icon: 'üêæ',
                items: ['dog', 'cat', 'bird', 'fish', 'cow', 'tree', 'flower', 'leaf'],
                emojis: ['üêï', 'üêà', 'üê¶', 'üê†', 'üêÑ', 'üå≥', 'üå∏', 'üçÉ']
            },
            opposites: {
                name: 'Opposites',
                icon: '‚ÜîÔ∏è',
                pairs: [
                    {a: 'big', b: 'small', emoji: ['üì¶', 'üì´']},
                    {a: 'hot', b: 'cold', emoji: ['üî•', '‚ùÑÔ∏è']},
                    {a: 'fast', b: 'slow', emoji: ['üêá', 'üê¢']},
                    {a: 'up', b: 'down', emoji: ['‚¨ÜÔ∏è', '‚¨áÔ∏è']},
                    {a: 'open', b: 'closed', emoji: ['üìÇ', 'üìÅ']}
                ]
            }
        };
      const teachingGuides = {
            colors: {
                introduction: "Today we're learning about colors! Colors are all around us and help us describe the world.",
                prompts: {
                    red: {
                        show: "Look at this red color! Can you point to it?",
                        say: "This is RED. Can you say 'red'?",
                        practice: "Let's find red things together! üçé What else is red?",
                        tips: "Point to red objects around the room. Say 'This apple is RED' or 'Your shirt is RED'",
                        hints: ["If struggling: Touch the red color and say 'RED' together", "Make it fun: 'Red like a fire truck!'", "Connect to emotions: 'Red means stop on traffic lights'"]
                    },
                    orange: {
                        show: "Look at this orange color!",
                        say: "This is ORANGE. Say 'orange' with me!",
                        practice: "Can you find something orange? üçä",
                        tips: "Show oranges, carrots, or orange toys",
                        hints: ["If struggling: 'Orange like a carrot or pumpkin'", "Sing: 'O-R-A-N-G-E spells orange!'"]
                    },
                    yellow: {
                        show: "Look at this bright yellow!",
                        say: "This is YELLOW. Can you say 'yellow'?",
                        practice: "What else is yellow? üåü",
                        tips: "Point to the sun, bananas, or yellow flowers",
                        hints: ["If struggling: 'Yellow like the sun!'", "Make connection: 'Lemons are yellow'"]
                    },
                    green: {
                        show: "See this green color?",
                        say: "This is GREEN. Say 'green'!",
                        practice: "Let's find green things! üåø",
                        tips: "Go outside and look at grass, leaves, trees",
                        hints: ["If struggling: 'Green like grass'", "Touch leaves: 'Feel this green leaf'"]
                    },
                    blue: {
                        show: "Look at this blue!",
                        say: "This is BLUE. Can you say 'blue'?",
                        practice: "What's blue around us? üíô",
                        tips: "Point to the sky, water, or blue clothing",
                        hints: ["If struggling: 'Blue like the sky'", "Sing: 'Blue, blue, I see something blue'"]
                    },
                    purple: {
                        show: "See this purple color?",
                        say: "This is PURPLE. Say 'purple'!",
                        practice: "Can you find purple? üíú",
                        tips: "Show grapes, eggplant, or purple flowers",
                        hints: ["If struggling: 'Purple like grapes'", "Mix colors: 'Red and blue make purple!'"]
                    },
                    black: {
                        show: "Look at black!",
                        say: "This is BLACK. Say 'black'!",
                        practice: "What's black?",
                        tips: "Point to text in books, night sky, or black objects",
                        hints: ["If struggling: 'Black like night time'", "Touch: 'Feel this black marker'"]
                    },
                    white: {
                        show: "See this white color?",
                        say: "This is WHITE. Can you say 'white'?",
                        practice: "Where's white?",
                        tips: "Point to paper, clouds, white clothing",
                        hints: ["If struggling: 'White like snow or clouds'", "Touch: 'This white paper'"]
                    },
                    gray: {
                        show: "Look at gray!",
                        say: "This is GRAY. Say 'gray'!",
                        practice: "Find gray things!",
                        tips: "Show elephants, clouds, rocks",
                        hints: ["If struggling: 'Gray like an elephant'", "Mix: 'Black and white make gray'"]
                    },
                    brown: {
                        show: "See this brown?",
                        say: "This is BROWN. Say 'brown'!",
                        practice: "What's brown around us?",
                        tips: "Point to wood, dirt, chocolate, teddy bears",
                        hints: ["If struggling: 'Brown like a teddy bear'", "Touch: 'Feel this brown tree bark'"]
                    }
                }
            },
            shapes: {
                introduction: "Let's explore shapes! Shapes are the forms of things around us.",
                prompts: {
                    circle: {
                        show: "Look at this circle! It's round and has no corners.",
                        say: "This is a CIRCLE. Say 'circle'!",
                        practice: "Let's find circles! Can you trace this circle with your finger? ‚≠ï",
                        tips: "Use plates, coins, wheels. Let them trace circles in the air.",
                        hints: ["If struggling: 'Round like a ball'", "Trace together: Follow the circle with your finger", "Find: 'Where are circles in this room?'"]
                    },
                    square: {
                        show: "See this square? It has 4 equal sides and 4 corners.",
                        say: "This is a SQUARE. Can you say 'square'?",
                        practice: "Count the sides: 1, 2, 3, 4! ‚óªÔ∏è",
                        tips: "Use blocks, windows, crackers. Count corners together.",
                        hints: ["If struggling: 'Four equal sides'", "Count: 'Let's count the corners: 1, 2, 3, 4'", "Compare: 'Different from a circle - it has corners!'"]
                    },
                    rectangle: {
                        show: "Look at this rectangle! It has 2 long sides and 2 short sides.",
                        say: "This is a RECTANGLE. Say 'rectangle'!",
                        practice: "Find rectangles! Books, doors, phones!",
                        tips: "Point to doors, books, phones, tables",
                        hints: ["If struggling: 'Like a long square'", "Touch: 'Feel the long side, now the short side'", "Compare: 'Longer than a square'"]
                    },
                    triangle: {
                        show: "See this triangle? It has 3 sides and 3 pointy corners.",
                        say: "This is a TRIANGLE. Say 'triangle'!",
                        practice: "Count the points: 1, 2, 3! üî∫",
                        tips: "Make triangle with hands, find in toys, pizza slices",
                        hints: ["If struggling: 'Three pointy corners'", "Make it: Use your fingers to make a triangle shape", "Count: 'One point, two points, three points!'"]
                    },
                    sphere: {
                        show: "Look at this sphere! It's like a 3D circle - round all around.",
                        say: "This is a SPHERE. Can you say 'sphere'?",
                        practice: "Roll it! Spheres can roll! üèÄ",
                        tips: "Use balls, oranges, globes. Let them roll it.",
                        hints: ["If struggling: 'Like a ball - round everywhere'", "Roll: 'Watch it roll!'", "Compare: 'A circle that's round all around'"]
                    },
                    oval: {
                        show: "See this oval? It's like a stretched circle - an egg shape!",
                        say: "This is an OVAL. Say 'oval'!",
                        practice: "Find ovals! Eggs, footballs!",
                        tips: "Show eggs, footballs, face shape",
                        hints: ["If struggling: 'Like an egg'", "Stretch: 'A circle that got stretched'", "Trace: 'Trace around this oval'"]
                    },
                    star: {
                        show: "Look at this star! It has points all around. ‚≠ê",
                        say: "This is a STAR. Say 'star'!",
                        practice: "Stars are in the sky at night! Can you make a star shape?",
                        tips: "Draw stars together, look at night sky, use stickers",
                        hints: ["If struggling: 'Twinkle twinkle little star'", "Count: 'How many points does our star have?'", "Draw: 'Let's draw a star together'"]
                    },
                    heart: {
                        show: "See this heart? It shows love! ‚ù§Ô∏è",
                        say: "This is a HEART. Say 'heart'!",
                        practice: "Hearts show we love something! Draw hearts in the air!",
                        tips: "Make heart with hands, draw hearts, talk about love",
                        hints: ["If struggling: 'I love you - draw a heart'", "Make it: 'Make a heart with your hands'", "Feel: 'Feel your heartbeat - that's your heart inside!'"]
                    }
                }
            },
            numbers: {
                introduction: "Let's count! Numbers help us know 'how many' of something we have.",
                prompts: {
                    '1': {
                        show: "Look! This is the number 1!",
                        say: "This is ONE. Say 'one'!",
                        practice: "Hold up 1 finger! Just one!",
                        tips: "Show one toy, one apple, one book",
                        hints: ["If struggling: 'Hold up one finger'", "Count: 'Just one! Only one!'", "Find: 'Show me one toy'"]
                    },
                    '2': {
                        show: "See the number 2?",
                        say: "This is TWO. Say 'two'!",
                        practice: "Hold up 2 fingers! Count them: 1, 2!",
                        tips: "Show pairs: two hands, two feet, two eyes",
                        hints: ["If struggling: 'Two like your two hands'", "Count: '1, 2 - two!'", "Find: 'You have two eyes, two ears'"]
                    },
                    '3': {
                        show: "Look at 3!",
                        say: "This is THREE. Say 'three'!",
                        practice: "Count 3 objects: 1, 2, 3!",
                        tips: "Count three toys, three crackers, three books",
                        hints: ["If struggling: 'One more than two'", "Count slowly: '1... 2... 3!'", "Clap: 'Clap three times!'"]
                    },
                    '4': {
                        show: "See number 4?",
                        say: "This is FOUR. Can you say 'four'?",
                        practice: "Count to 4! 1, 2, 3, 4!",
                        tips: "Four wheels on a car, four legs on a chair",
                        hints: ["If struggling: 'Count your fingers on one hand - stop at 4'", "Find: 'A chair has four legs'"]
                    },
                    '5': {
                        show: "Look at 5!",
                        say: "This is FIVE. Say 'five'!",
                        practice: "Show all fingers on one hand! Count: 1, 2, 3, 4, 5!",
                        tips: "Use one whole hand - five fingers!",
                        hints: ["If struggling: 'Five fingers on one hand'", "High five: 'Give me five!'", "Count toes: 'Five toes on one foot!'"]
                    },
                    '10': {
                        show: "This is 10!",
                        say: "This is TEN. Say 'ten'!",
                        practice: "Show all 10 fingers! Count them together!",
                        tips: "Use both hands - ten fingers total!",
                        hints: ["If struggling: 'All your fingers - that's ten!'", "Count: 'Let's count to 10 together'", "Song: 'Ten little fingers'"]
                    }
                }
            }
        };

        function logInteraction(action, data) {
            const logEntry = {
                timestamp: new Date().toISOString(),
                userId: state.userId,
                action: action,
                data: data
            };
            console.log('PANDA LOG:', logEntry);
        }

        function speakText(text) {
            if (!state.voiceEnabled) return;
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                utterance.volume = 1;
                window.speechSynthesis.speak(utterance);
            }
        }

        function toggleVoice() {
            state.voiceEnabled = !state.voiceEnabled;
            if (state.voiceEnabled) {
                speakText("Voice guidance enabled! I'll help you teach.");
            }
            render();
        }

        function toggleTeacherMode() {
            state.teacherMode = !state.teacherMode;
            render();
        }
      function startVoiceRecognition() {
            if (!state.voiceEnabled) {
                alert('Please turn on Voice first by clicking the "üîä Voice On" button.');
                return;
            }

            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('‚ö†Ô∏è Voice recognition needs Chrome, Edge, or Safari browser.\n\nYour browser doesn\'t support voice commands, but you can still use the buttons!');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                state.isListening = true;
                speakText("I'm listening. You can say: help, correct, incorrect, or next.");
                render();
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.toLowerCase();
                console.log('Heard:', transcript);
                handleVoiceCommand(transcript);
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                state.isListening = false;
                if (event.error === 'no-speech') {
                    speakText("I didn't hear anything. Try again!");
                } else if (event.error === 'not-allowed') {
                    alert('‚ö†Ô∏è Microphone permission denied.\n\nPlease allow microphone access in your browser settings.');
                }
                render();
            };

            recognition.onend = function() {
                state.isListening = false;
                render();
            };

            try {
                recognition.start();
            } catch (e) {
                console.error('Failed to start recognition:', e);
                alert('Could not start voice recognition. Please try again.');
                state.isListening = false;
                render();
            }
        }

        function handleVoiceCommand(transcript) {
            console.log('Voice command:', transcript);
            
            if (transcript.includes('help') || transcript.includes('hint') || transcript.includes('what do i say')) {
                const subject = state.currentSubject;
                const item = state.currentLesson || Object.keys(state.learningData[state.activeChildId][subject]).filter(i => !state.learningData[state.activeChildId][subject][i].mastered)[0];
                
                if (teachingGuides[subject] && teachingGuides[subject].prompts[item]) {
                    speakText(teachingGuides[subject].prompts[item].tips);
                }
                return;
            }
            
            if (transcript.includes('next') || transcript.includes('skip')) {
                speakText("Moving to the next item");
                checkAnswer(false);
                return;
            }
            
            if (transcript.includes('correct') || transcript.includes('right') || transcript.includes('yes')) {
                checkAnswer(true);
                return;
            }
            
            if (transcript.includes('wrong') || transcript.includes('incorrect') || transcript.includes('no')) {
                checkAnswer(false);
                return;
            }

            speakText("I didn't understand that. You can say 'correct', 'incorrect', 'help', or 'next'.");
        }

        function renderOpeningPage() {
            return `
                <div class="min-h-screen flex items-center justify-center p-8">
                    <div class="bg-white rounded-3xl shadow-2xl p-12 max-w-2xl text-center">
                        <div class="text-8xl mb-6">üêº</div>
                        <h1 class="text-5xl font-bold text-panda-blue mb-4">PANDA Learning Hub</h1>
                        <p class="text-xl text-gray-600 mb-8">Parenting And Neuroscience: Developmental Advancement</p>
                        <p class="text-lg text-gray-700 mb-8">An interactive learning platform for families</p>
                        <button onclick="state.currentView='consent'; render();" class="bg-gradient-to-r from-panda-blue to-panda-light-blue text-white px-12 py-4 rounded-2xl text-xl font-bold hover:shadow-xl transition-all">
                            Get Started ‚Üí
                        </button>
                    </div>
                </div>
            `;
        }

        function renderConsentForm() {
            return `
                <div class="min-h-screen flex items-center justify-center p-8 overflow-y-auto">
                    <div class="bg-white rounded-3xl shadow-2xl p-12 max-w-4xl my-8">
                        <h2 class="text-3xl font-bold text-panda-blue mb-6">Informed Consent for Research</h2>
                        <div class="bg-blue-50 border-l-4 border-panda-blue p-6 mb-6 rounded">
                            <p class="font-semibold text-lg mb-2">University of North Carolina at Chapel Hill</p>
                            <p class="text-gray-700">IRB Study #25-0805</p>
                            <p class="text-gray-700">Principal Investigator: Rahiem Brooks, PhD Candidate</p>
                        </div>
                        <div class="space-y-4 text-gray-700 max-h-96 overflow-y-auto mb-6 p-4 border rounded">
                            <p class="font-semibold text-lg">Study Title: PANDA Learning Hub - Parent-Child Learning Intervention</p>
                            <p><strong>Purpose:</strong> This study examines how structured parent-child learning activities support early childhood development.</p>
                            <p><strong>What you will do:</strong> Use this app for educational activities with your child over 20 days. Activities include colors, shapes, numbers, and more.</p>
                            <p><strong>Time:</strong> Approximately 10-15 minutes per day for 20 days.</p>
                            <p><strong>Risks:</strong> Minimal. Activities are designed to be age-appropriate and engaging.</p>
                            <p><strong>Benefits:</strong> Your child may benefit from structured learning. You will gain parenting strategies based on neuroscience.</p>
                            <p><strong>Privacy:</strong> All data is stored locally on your device. We collect anonymous usage data for research purposes only.</p>
                            <p><strong>Voluntary:</strong> Participation is completely voluntary. You may stop at any time.</p>
                            <p><strong>Questions:</strong> Contact Rahiem Brooks at rahiem@unc.edu</p>
                        </div>
                        <div class="bg-yellow-50 border-2 border-yellow-400 rounded-lg p-4 mb-6">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" id="consentCheckbox" class="w-6 h-6" onchange="state.consentGiven=this.checked; render();">
                                <span class="text-gray-800 font-medium">I have read and understood the above information. I consent to participate in this research study.</span>
                            </label>
                        </div>
                        <button onclick="if(state.consentGiven){state.userId='user_'+Date.now(); state.currentView='roleSelection'; logInteraction('consent_given', {}); render();}else{alert('Please check the consent box to continue.');}" class="w-full bg-panda-blue text-white px-8 py-4 rounded-xl text-xl font-bold hover:bg-blue-800 transition-colors ${state.consentGiven ? '' : 'opacity-50 cursor-not-allowed'}">
                            Continue to App ‚Üí
                        </button>
                    </div>
                </div>
            `;
        }

        function renderRoleSelection() {
            return `
                <div class="min-h-screen flex items-center justify-center p-8">
                    <div class="max-w-4xl w-full">
                        <h2 class="text-4xl font-bold text-center text-panda-blue mb-12">Who will be using the app?</h2>
                        <div class="grid md:grid-cols-2 gap-8">
                            <button onclick="selectRole('parent')" class="bg-white rounded-3xl p-12 shadow-xl hover:shadow-2xl transition-all border-4 border-transparent hover:border-panda-blue">
                                <div class="text-8xl mb-6">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                                <h3 class="text-3xl font-bold text-panda-blue mb-4">Parents</h3>
                                <p class="text-gray-600 text-lg">Access coaching tips, resources, and track your family's progress</p>
                            </button>
                            <button onclick="selectRole('child')" class="bg-white rounded-3xl p-12 shadow-xl hover:shadow-2xl transition-all border-4 border-transparent hover:border-panda-orange">
                                <div class="text-8xl mb-6">üë∂</div>
                                <h3 class="text-3xl font-bold text-panda-orange mb-4">Children</h3>
                                <p class="text-gray-600 text-lg">Fun learning activities with colors, shapes, numbers, and more!</p>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function selectRole(role) {
            state.userRole = role;
            logInteraction('role_selected', { role });
            if (role === 'parent') {
                state.currentView = 'parentDashboard';
            } else {
                state.currentView = 'childManagement';
            }
            render();
        }

        function resetApp() {
            state.userRole = null;
            state.currentView = 'roleSelection';
            render();
        }
      function renderParentDashboard() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-8">
                    <div class="max-w-7xl mx-auto">
                        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h1 class="text-3xl font-bold text-panda-blue">Parent Dashboard</h1>
                                    <p class="text-gray-600">Welcome to your learning hub</p>
                                </div>
                                <button onclick="resetApp()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-colors">
                                    ‚Üê Back to Home
                                </button>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl shadow-lg mb-6">
                            <div class="flex overflow-x-auto">
                                <button onclick="setActiveTab('coaching')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap rounded-tl-2xl ${state.activeTab === 'coaching' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    üß† Coaching Tips
                                </button>
                                <button onclick="setActiveTab('labeling')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'labeling' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    üè∑Ô∏è Home Labeling
                                </button>
                                <button onclick="setActiveTab('calendar')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'calendar' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    üìÖ Calendar
                                </button>
                                <button onclick="setActiveTab('journal')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'journal' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    üìì Journal
                                </button>
                                <button onclick="setActiveTab('resources')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'resources' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    üéÅ Resources
                                </button>
                                <button onclick="setActiveTab('surveys')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'surveys' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    üìã Surveys
                                </button>
                                <button onclick="setActiveTab('analytics')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'analytics' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    üìä Progress
                                </button>
                            </div>
                        </div>

                        <div id="tabContent" class="bg-white rounded-2xl shadow-lg p-8"></div>
                    </div>
                </div>
            `;
        }

        function renderCoachingTips() {
            const tips = [
                {
                    day: 1,
                    title: "Building Neural Pathways Through Repetition",
                    content: "Young children's brains form new neural connections through repeated exposure. When teaching colors, show the same color in multiple contexts throughout the day.",
                    practicalTip: "Point out 'red' items during meals, playtime, and outdoor walks."
                },
                {
                    day: 2,
                    title: "The Power of Multisensory Learning",
                    content: "The brain processes sensory information in different regions. Combining visual, auditory, and tactile experiences creates multiple neural pathways.",
                    practicalTip: "When teaching 'circle,' let your child touch round objects, trace circles, and say the word together."
                },
                {
                    day: 3,
                    title: "Emotional Connection Enhances Memory",
                    content: "The amygdala links emotions to memories. Positive emotional experiences trigger dopamine release, strengthening neural connections.",
                    practicalTip: "Celebrate discoveries with enthusiasm! 'You found a triangle! High five!'"
                }
            ];

            return `
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-3xl font-bold text-panda-blue mb-6">Daily Coaching Tips</h2>
                    <div class="space-y-6">
                        ${tips.map(tip => `
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6 border-2 border-panda-light-blue">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-panda-blue text-white rounded-full flex items-center justify-center text-xl font-bold">
                                        ${tip.day}
                                    </div>
                                    <h3 class="text-xl font-bold text-panda-blue">${tip.title}</h3>
                                </div>
                                <p class="text-gray-700 mb-4">${tip.content}</p>
                                <div class="bg-white rounded-xl p-4 border-l-4 border-panda-orange">
                                    <p class="font-semibold text-panda-orange mb-2">üí° Try This:</p>
                                    <p class="text-gray-700">${tip.practicalTip}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderLabelingGuide() {
            return `
                <div class="max-w-5xl mx-auto">
                    <h2 class="text-3xl font-bold text-panda-blue mb-6">Home Labeling Guide</h2>
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 mb-6">
                        <p class="text-gray-700 text-lg">Transform your home into a learning environment by labeling everyday objects. This simple practice builds vocabulary and supports early literacy.</p>
                    </div>
                    <div class="space-y-6">
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-300">
                            <h3 class="text-2xl font-bold text-panda-blue mb-4">üçΩÔ∏è Kitchen & Dining</h3>
                            <div class="flex flex-wrap gap-2">
                                ${['TABLE', 'CHAIR', 'PLATE', 'BOWL', 'CUP', 'SPOON', 'FORK', 'REFRIGERATOR', 'STOVE', 'SINK'].map(item => 
                                    `<span class="bg-blue-100 text-panda-blue px-3 py-1.5 rounded-full text-sm font-semibold">${item}</span>`
                                ).join('')}
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-300">
                            <h3 class="text-2xl font-bold text-panda-blue mb-4">üõãÔ∏è Living Room</h3>
                            <div class="flex flex-wrap gap-2">
                                ${['COUCH', 'TV', 'LAMP', 'TABLE', 'BOOKSHELF', 'WINDOW', 'DOOR', 'PILLOW'].map(item => 
                                    `<span class="bg-blue-100 text-panda-blue px-3 py-1.5 rounded-full text-sm font-semibold">${item}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderJournal() {
            return `
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-3xl font-bold text-panda-blue mb-6">Parent Journal</h2>
                    <div class="bg-blue-50 rounded-xl p-6 mb-6">
                        <p class="text-gray-700">Reflect on your child's learning journey. Your observations help track progress and celebrate milestones.</p>
                    </div>
                    <div class="space-y-4">
                        <textarea id="journalEntry" placeholder="What did you notice today? What worked well? What challenges did you face?" class="w-full h-32 p-4 border-2 border-gray-300 rounded-xl"></textarea>
                        <button onclick="saveJournalEntry()" class="px-6 py-3 bg-panda-blue text-white rounded-xl font-semibold hover:bg-blue-800">
                            Save Entry
                        </button>
                    </div>
                </div>
            `;
        }

        function saveJournalEntry() {
            const entry = document.getElementById('journalEntry').value;
            if (entry.trim()) {
                state.journalEntries.push({
                    date: new Date().toISOString(),
                    content: entry
                });
                alert('Journal entry saved!');
                document.getElementById('journalEntry').value = '';
            }
        }

        function renderResources() {
            return `
                <div class="max-w-5xl mx-auto">
                    <h2 class="text-3xl font-bold text-panda-blue mb-6">Community Resources</h2>
                    <div class="bg-orange-50 rounded-2xl p-8 text-center">
                        <p class="text-xl text-gray-700">Resource links and community support coming soon!</p>
                    </div>
                </div>
            `;
        }

        function renderChildManagement() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 p-8">
                    <div class="max-w-6xl mx-auto">
                        <div class="flex justify-between items-center mb-8">
                            <h1 class="text-5xl font-bold text-panda-blue">üë∂ My Children</h1>
                            <button onclick="resetApp()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300">‚Üê Back</button>
                        </div>

                        ${state.children.length < 5 ? `
                            <div class="bg-white rounded-3xl shadow-xl p-8 mb-8">
                                <h3 class="text-2xl font-bold text-panda-blue mb-6">Add a Child</h3>
                                <div class="flex gap-4">
                                    <input type="text" id="childNameInput" placeholder="Enter child's name..." class="flex-1 px-6 py-4 border-2 border-gray-300 rounded-xl text-lg" onkeypress="if(event.key==='Enter') addChild()"/>
                                    <button onclick="addChild()" class="px-8 py-4 bg-panda-blue text-white rounded-xl text-lg font-semibold hover:bg-blue-800">+ Add Child</button>
                                </div>
                            </div>
                        ` : ''}

                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${state.children.map(child => `
                                <div class="bg-white rounded-2xl shadow-lg p-6 border-2 border-panda-light-blue">
                                    <div class="flex justify-between items-start mb-4">
                                        <h3 class="text-2xl font-bold text-panda-blue">${child.name}</h3>
                                        <button onclick="removeChild('${child.id}')" class="text-red-500 hover:text-red-700">‚úï</button>
                                    </div>
                                    <button onclick="selectChild('${child.id}')" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-xl font-semibold hover:from-purple-600 hover:to-pink-600">
                                        ${child.preAssessmentComplete ? 'Continue Learning ‚Üí' : 'Start Assessment ‚Üí'}
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function addChild() {
            const input = document.getElementById('childNameInput');
            const name = input.value.trim();
            if (!name) {
                alert('Please enter a name!');
                return;
            }
            const childId = `child_${Date.now()}`;
            state.children.push({
                id: childId,
                name: name,
                dateAdded: new Date().toISOString(),
                preAssessmentComplete: false
            });
            state.learningData[childId] = initializeLearningData();
            input.value = '';
            render();
        }

        function removeChild(childId) {
            if (confirm('Remove this child?')) {
                state.children = state.children.filter(c => c.id !== childId);
                delete state.learningData[childId];
                render();
            }
        }

        function selectChild(childId) {
            state.activeChildId = childId;
            const child = state.children.find(c => c.id === childId);
            if (!child.preAssessmentComplete) {
                state.currentView = 'assessment';
                state.assessmentType = 'pre';
                startAssessment();
            } else {
                state.currentView = 'childLearning';
            }
            render();
        }

        function initializeLearningData() {
            const data = {};
            Object.keys(curriculum).forEach(subject => {
                data[subject] = {};
                if (subject === 'opposites') {
                    curriculum[subject].pairs.forEach(pair => {
                        data[subject][`${pair.a}/${pair.b}`] = { attempts: 0, correct: 0, incorrect: 0, consecutiveCorrect: 0, mastered: false };
                    });
                } else {
                    curriculum[subject].items.forEach(item => {
                        data[subject][item] = { attempts: 0, correct: 0, incorrect: 0, consecutiveCorrect: 0, mastered: false };
                    });
                }
            });
            return data;
        }

        function calculateProgress(childId) {
            const data = state.learningData[childId];
            if (!data) return 0;
            let total = 0, mastered = 0;
            Object.keys(data).forEach(subject => {
                Object.keys(data[subject]).forEach(item => {
                    total++;
                    if (data[subject][item].mastered) mastered++;
                });
            });
            return total > 0 ? Math.round((mastered / total) * 100) : 0;
        }

        function startAssessment() {
            const assessmentItems = [];
            const distribution = { colors: 7, shapes: 6, numbers: 7 };
            Object.keys(distribution).forEach(subject => {
                const items = [...curriculum[subject].items];
                for (let i = 0; i < distribution[subject] && items.length > 0; i++) {
                    assessmentItems.push({ subject, item: items.splice(Math.floor(Math.random() * items.length), 1)[0] });
                }
            });
            for (let i = assessmentItems.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [assessmentItems[i], assessmentItems[j]] = [assessmentItems[j], assessmentItems[i]];
            }
            state.currentAssessment = { items: assessmentItems, currentIndex: 0, responses: [] };
        }
      function renderAssessment() {
            if (!state.currentAssessment) startAssessment();
            const assessment = state.currentAssessment;
            const currentItem = assessment.items[assessment.currentIndex];
            const child = state.children.find(c => c.id === state.activeChildId);
            const progress = ((assessment.currentIndex / assessment.items.length) * 100);
            
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center p-8">
                    <div class="max-w-4xl w-full">
                        <div class="bg-white rounded-3xl shadow-2xl p-12">
                            <div class="text-center mb-8">
                                <h2 class="text-3xl font-bold text-panda-blue mb-2">${child.name}'s Assessment</h2>
                                <p class="text-gray-600 mb-4">Question ${assessment.currentIndex + 1} of ${assessment.items.length}</p>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-full transition-all" style="width: ${progress}%"></div>
                                </div>
                            </div>
                            <div class="text-center mb-8">
                                ${renderAssessmentItem(currentItem)}
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-gray-800 mb-6">What is this?</p>
                                <div class="flex gap-4 justify-center">
                                    <button onclick="recordAssessmentAnswer(true)" class="px-12 py-6 bg-green-500 text-white rounded-2xl text-2xl font-bold hover:bg-green-600 shadow-lg">‚úì Correct</button>
                                    <button onclick="recordAssessmentAnswer(false)" class="px-12 py-6 bg-red-500 text-white rounded-2xl text-2xl font-bold hover:bg-red-600 shadow-lg">‚úó Incorrect</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAssessmentItem(item) {
            if (item.subject === 'colors') {
                const colors = {red:'#EF4444',orange:'#F97316',yellow:'#EAB308',green:'#22C55E',blue:'#3B82F6',purple:'#A855F7',black:'#000',white:'#FFF',gray:'#6B7280',brown:'#92400E'};
                return `<div class="w-64 h-64 mx-auto rounded-3xl shadow-2xl" style="background-color:${colors[item.item]};${item.item==='white'?'border:4px solid #E5E7EB;':''}"></div>`;
            } else if (item.subject === 'shapes') {
                const shapes = {
                    circle: '<div class="w-64 h-64 bg-blue-500 rounded-full mx-auto shadow-2xl"></div>',
                    square: '<div class="w-64 h-64 bg-red-500 mx-auto shadow-2xl"></div>',
                    rectangle: '<div class="w-80 h-48 bg-green-500 mx-auto shadow-2xl"></div>',
                    triangle: '<div style="width:0;height:0;border-left:128px solid transparent;border-right:128px solid transparent;border-bottom:220px solid #EAB308;margin:0 auto;"></div>',
                    sphere: '<div class="w-64 h-64 rounded-full mx-auto shadow-2xl" style="background:radial-gradient(circle at 30% 30%,#93C5FD,#1E40AF);"></div>',
                    oval: '<div class="w-80 h-48 bg-purple-500 rounded-full mx-auto shadow-2xl"></div>',
                    star: '<div class="text-9xl">‚≠ê</div>',
                    heart: '<div class="text-9xl">‚ù§Ô∏è</div>'
                };
                return shapes[item.item] || '';
            } else if (item.subject === 'numbers') {
                return `<div class="text-9xl font-bold text-panda-blue">${item.item}</div>`;
            }
            return '';
        }

        function recordAssessmentAnswer(isCorrect) {
            const assessment = state.currentAssessment;
            assessment.responses.push({...assessment.items[assessment.currentIndex], correct: isCorrect});
            if (assessment.currentIndex < assessment.items.length - 1) {
                assessment.currentIndex++;
                render();
            } else {
                completeAssessment();
            }
        }

        function completeAssessment() {
            const child = state.children.find(c => c.id === state.activeChildId);
            const assessment = state.currentAssessment;
            const correct = assessment.responses.filter(r => r.correct).length;
            const score = Math.round((correct / assessment.responses.length) * 100);
            child.preAssessmentComplete = true;
            child.preAssessmentScore = score;
            alert(`Assessment Complete!\n\n${child.name} scored ${score}%\n\nLet's start learning!`);
            state.currentAssessment = null;
            state.currentView = 'childLearning';
            render();
        }

        function renderChildLearning() {
            const child = state.children.find(c => c.id === state.activeChildId);
            const progress = calculateProgress(state.activeChildId);
            return `
                <div class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 p-8">
                    <div class="max-w-7xl mx-auto">
                        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h1 class="text-3xl font-bold text-panda-blue">${child.name}'s Learning</h1>
                                    <p class="text-gray-600">Overall: ${progress}% Mastered</p>
                                </div>
                                <button onclick="state.currentView='childManagement'; render();" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300">‚Üê Back</button>
                            </div>
                        </div>
                        ${!state.currentSubject ? `
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6 mb-6 border-2 border-blue-300">
                                <h3 class="text-xl font-bold text-blue-800 mb-2">üë®‚Äçüè´ Parent as Teacher Mode Available!</h3>
                                <p class="text-gray-700">Turn on Voice and Teacher Mode when practicing for step-by-step guidance!</p>
                            </div>
                        ` : ''}
                        <div class="grid md:grid-cols-3 lg:grid-cols-4 gap-6 mb-8">
                            ${['colors','shapes','numbers','letters','clothing','household','animals','opposites'].map(s => renderSubjectCard(s, ['colors','shapes','numbers'].includes(s))).join('')}
                        </div>
                        ${state.currentSubject ? renderSubjectPractice() : ''}
                    </div>
                </div>
            `;
        }

        function renderSubjectCard(subject, isActive) {
            const subjectData = curriculum[subject];
            if (!isActive) {
                return `<div class="bg-gray-100 rounded-2xl p-6 opacity-60 text-center"><div class="text-5xl mb-3">${subjectData.icon}</div><h3 class="text-xl font-bold text-gray-600">${subjectData.name}</h3><p class="text-sm text-gray-500 mt-2">Coming Soon</p></div>`;
            }
            const childData = state.learningData[state.activeChildId][subject];
            let mastered = 0, total = 0;
            Object.keys(childData).forEach(item => {total++; if(childData[item].mastered) mastered++;});
            const percentage = total > 0 ? Math.round((mastered / total) * 100) : 0;
            return `
                <button onclick="selectSubject('${subject}')" class="bg-white rounded-2xl p-6 border-2 border-panda-light-blue hover:border-panda-blue hover:shadow-xl transition-all">
                    <div class="text-center mb-4">
                        <div class="text-5xl mb-3">${subjectData.icon}</div>
                        <h3 class="text-xl font-bold text-panda-blue">${subjectData.name}</h3>
                    </div>
                    <div class="mb-2">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-600">Progress</span>
                            <span class="font-semibold text-panda-blue">${percentage}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-gradient-to-r from-green-400 to-green-600 h-full" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 text-center">${mastered}/${total} mastered</p>
                </button>
            `;
        }

        function selectSubject(subject) {
            state.currentSubject = subject;
            state.currentLesson = null;
            render();
        }

        function renderSubjectPractice() {
            const subject = state.currentSubject;
            const subjectData = curriculum[subject];
            const childData = state.learningData[state.activeChildId][subject];
            const items = Object.keys(childData).filter(item => !childData[item].mastered);
            if (items.length === 0) {
                return `<div class="bg-green-50 border-2 border-green-400 rounded-2xl p-8 text-center"><div class="text-6xl mb-4">üéâ</div><h3 class="text-2xl font-bold text-green-700 mb-2">All Mastered!</h3><button onclick="state.currentSubject=null; render();" class="px-6 py-3 bg-panda-blue text-white rounded-xl font-semibold">Choose Another Subject</button></div>`;
            }
            const currentItem = state.currentLesson || items[0];
            const itemData = childData[currentItem];
            const teachingPrompt = teachingGuides[subject]?.prompts[currentItem];
            const allItems = curriculum[subject].items;
            const otherItems = allItems.filter(item => item !== currentItem);
            const incorrectOptions = [];
            while (incorrectOptions.length < 2 && otherItems.length > 0) {
                incorrectOptions.push(otherItems.splice(Math.floor(Math.random() * otherItems.length), 1)[0]);
            }
            const options = [currentItem, ...incorrectOptions].sort(() => Math.random() - 0.5);
            
            return `
                <div class="bg-white rounded-2xl p-8 shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-panda-blue">Practice: ${subjectData.name}</h3>
                        <div class="flex gap-2">
                            <button onclick="toggleVoice()" class="px-4 py-2 rounded-xl font-semibold ${state.voiceEnabled ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700'}">
                                ${state.voiceEnabled ? 'üîä Voice On' : 'üîá Voice Off'}
                            </button>
                            <button onclick="toggleTeacherMode()" class="px-4 py-2 rounded-xl font-semibold ${state.teacherMode ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'}">
                                ${state.teacherMode ? 'üë®‚Äçüè´ Guide On' : 'üë§ Guide Off'}
                            </button>
                            <button onclick="state.currentSubject=null; render();" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-xl">Back</button>
                        </div>
                    </div>
                    ${state.teacherMode && teachingPrompt ? `
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 mb-6 border-2 border-purple-200">
                            <h4 class="text-xl font-bold text-purple-700 mb-4">üë®‚Äçüè´ Parent Guide: Teaching "${currentItem}"</h4>
                            <div class="space-y-3">
                                <div class="bg-white rounded-xl p-4">
                                    <p class="font-bold text-purple-700 mb-2">1Ô∏è‚É£ Say to Your Child:</p>
                                    <p class="text-gray-800 text-lg">"${teachingPrompt.say}"</p>
                                    <button onclick="speakText('${teachingPrompt.say.replace(/'/g, "\\'")}');" class="text-sm text-purple-600 hover:text-purple-800 mt-2 px-3 py-1 bg-purple-100 rounded-lg">üîä Play Audio</button>
                                </div>
                                <div class="bg-white rounded-xl p-4">
                                    <p class="font-bold text-blue-700 mb-2">2Ô∏è‚É£ Point & Show:</p>
                                    <p class="text-gray-800">${teachingPrompt.show}</p>
                                </div>
                                <div class="bg-yellow-50 rounded-xl p-4 border-2 border-yellow-300">
                                    <p class="font-bold text-yellow-800 mb-2">üí° Tips:</p>
                                    <p class="text-gray-700 text-sm">${teachingPrompt.tips}</p>
                                </div>
                                ${itemData.incorrect > 1 ? `
                                    <div class="bg-orange-50 rounded-xl p-4 border-2 border-orange-300">
                                        <p class="font-bold text-orange-800 mb-2">üÜò Helpful Hints:</p>
                                        <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
                                            ${teachingPrompt.hints.map(hint => `<li>${hint}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                    <div class="text-center mb-8">
                        <h2 class="text-4xl font-bold text-gray-800 mb-6">
                            Which one is <span class="text-panda-blue">${currentItem.toUpperCase()}</span>?
                        </h2>
                        <p class="text-gray-600 mb-8">Click on the correct answer:</p>
                    </div>
                    <div class="grid grid-cols-3 gap-6 mb-8 max-w-4xl mx-auto">
                        ${options.map((option, index) => `
                            <button onclick="selectAnswer('${option}')" class="bg-white border-4 border-gray-300 rounded-2xl p-6 hover:border-panda-blue hover:shadow-xl transition-all transform hover:scale-105">
                                ${renderLearningOption(subject, option)}
                                <p class="text-center text-lg font-bold text-gray-700 mt-4">Option ${index + 1}</p>
                            </button>
                        `).join('')}
                    </div>
                    <div class="bg-gray-50 rounded-xl p-6 max-w-2xl mx-auto">
                        <div class="flex items-center justify-between mb-4">
                            <p class="text-lg font-semibold text-gray-700">Progress to Master "${currentItem}":</p>
                            <p class="text-sm text-gray-600">${itemData.attempts} attempts</p>
                        </div>
                        <div class="flex gap-3 justify-center">
                            ${Array.from({length: 3}, (_, i) => `
                                <div class="flex flex-col items-center">
                                    <div class="w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold ${i < itemData.consecutiveCorrect ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-400'}">
                                        ${i < itemData.consecutiveCorrect ? '‚úì' : (i + 1)}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <p class="text-center text-sm text-gray-600 mt-4">
                            ${itemData.consecutiveCorrect === 0 ? 'Need 3 correct in a row!' : 
                              itemData.consecutiveCorrect === 1 ? 'üéâ Great! 2 more!' : 'üåü Almost there! Just 1 more!'}
                        </p>
                    </div>
                    ${state.voiceEnabled ? `
                        <div class="text-center mt-6">
                            <button onclick="askForHelp()" class="px-6 py-3 bg-blue-500 text-white rounded-xl font-semibold hover:bg-blue-600">
                                üé§ Need Help?
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderLearningOption(subject, item) {
            if (subject === 'colors') {
                const colorImages = {
                    red: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjRUY0NDQ0Ii8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42OPC90ZXh0Pjwvc3ZnPg==',
                    orange: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjRjk3MzE2Ii8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42KPC90ZXh0Pjwvc3ZnPg==',
                    yellow: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjRUFCMzA4Ii8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42LPC90ZXh0Pjwvc3ZnPg==',
                    green: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjMjJDNTVFIi8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42MPC90ZXh0Pjwvc3ZnPg==',
                    blue: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjM0I4MkY2Ii8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5qXPC90ZXh0Pjwvc3ZnPg==',
                    purple: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjQTg1NUY3Ii8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42HPC90ZXh0Pjwvc3ZnPg==',
                    black: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTE1IiBmb250LXNpemU9IjQ4IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+lvTwvdGV4dD48L3N2Zz4=',
                    white: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI0ZGRkZGRiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiLz48dGV4dCB4PSIxMDAiIHk9IjExNSIgZm9udC1zaXplPSI0OCIgZmlsbD0iYmxhY2siIHRleHQtYW5jaG9yPSJtaWRkbGUiPuKYgTwvdGV4dD48L3N2Zz4=',
                    gray: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzZCNzI4MCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTE1IiBmb250LXNpemU9IjQ4IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+QmDwvdGV4dD48L3N2Zz4=',
                    brown: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzkyNDAwRSIvPjx0ZXh0IHg9IjEwMCIgeT0iMTE1IiBmb250LXNpemU9IjQ4IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+ngTwvdGV4dD48L3N2Zz4='
                };
                return `<img src="${colorImages[item]}" alt="${item}" class="w-full h-48 object-contain rounded-xl" />`;
            } else if (subject === 'shapes') {
                const shapes = {
                    circle: '<div class="w-32 h-32 bg-blue-500 rounded-full mx-auto"></div>',
                    square: '<div class="w-32 h-32 bg-red-500 mx-auto"></div>',
                    rectangle: '<div class="w-40 h-24 bg-green-500 mx-auto"></div>',
                    triangle: '<div style="width:0;height:0;border-left:64px solid transparent;border-right:64px solid transparent;border-bottom:110px solid #EAB308;margin:0 auto;"></div>',
                    sphere: '<div class="w-32 h-32 rounded-full mx-auto" style="background:radial-gradient(circle at 30% 30%,#93C5FD,#1E40AF);"></div>',
                    oval: '<div class="w-40 h-24 bg-purple-500 rounded-full mx-auto"></div>',
                    star: '<div class="text-8xl text-yellow-400 text-center">‚≠ê</div>',
                    heart: '<div class="text-8xl text-red-500 text-center">‚ù§Ô∏è</div>'
                };
                return shapes[item] || '';
            } else if (subject === 'numbers') {
                return `<div class="text-8xl font-bold text-panda-blue text-center">${item}</div>`;
            }
            return '';
        }

        function selectAnswer(selectedItem) {
            const subject = state.currentSubject;
            const items = Object.keys(state.learningData[state.activeChildId][subject]).filter(i => !state.learningData[state.activeChildId][subject][i].mastered);
            const correctItem = state.currentLesson || items[0];
            checkAnswer(selectedItem === correctItem);
        }

        function askForHelp() {
            const subject = state.currentSubject;
            const items = Object.keys(state.learningData[state.activeChildId][subject]).filter(i => !state.learningData[state.activeChildId][subject][i].mastered);
            const item = state.currentLesson || items[0];
            const teachingPrompt = teachingGuides[subject]?.prompts[item];
            if (teachingPrompt) {
                speakText(`Here's how to teach ${item}. ${teachingPrompt.tips}`);
            }
        }

        function checkAnswer(isCorrect) {
            const subject = state.currentSubject;
            const items = Object.keys(state.learningData[state.activeChildId][subject]).filter(i => !state.learningData[state.activeChildId][subject][i].mastered);
            const item = state.currentLesson || items[0];
            const itemData = state.learningData[state.activeChildId][subject][item];
            itemData.attempts++;
            if (isCorrect) {
                itemData.correct++;
                itemData.consecutiveCorrect++;
                if (itemData.consecutiveCorrect >= 3) {
                    itemData.mastered = true;
                    speakText(`Amazing! You mastered ${item}!`);
                    setTimeout(() => {
                        alert(`üéâ MASTERED: ${item}!`);
                        state.currentLesson = null;
                        render();
                    }, 100);
                } else {
                    speakText(`Correct! ${3 - itemData.consecutiveCorrect} more in a row!`);
                }
            } else {
                itemData.incorrect++;
                itemData.consecutiveCorrect = 0;
                speakText(`Not quite. This is ${item}. Let's try again!`);
            }
            render();
        }

        function setActiveTab(tab) {
            state.activeTab = tab;
            render();
        }

        function renderChildTutor() {
            return '<div class="text-center p-8">Child tutor placeholder</div>';
        }

        function render() {
            const app = document.getElementById('app');
            if (state.currentView === 'opening') {
                app.innerHTML = renderOpeningPage();
            } else if (state.currentView === 'consent') {
                app.innerHTML = renderConsentForm();
            } else if (state.currentView === 'roleSelection') {
                app.innerHTML = renderRoleSelection();
            } else if (state.currentView === 'parentDashboard') {
                app.innerHTML = renderParentDashboard();
                const tabContent = document.getElementById('tabContent');
                if (state.activeTab === 'coaching') {
                    tabContent.innerHTML = renderCoachingTips();
                } else if (state.activeTab === 'labeling') {
                    tabContent.innerHTML = renderLabelingGuide();
                } else if (state.activeTab === 'calendar') {
                    tabContent.innerHTML = '<div class="text-center text-gray-600 p-8 text-lg">üìÖ Learning Calendar coming soon</div>';
                } else if (state.activeTab === 'journal') {
                    tabContent.innerHTML = renderJournal();
                } else if (state.activeTab === 'resources') {
                    tabContent.innerHTML = renderResources();
                } else if (state.activeTab === 'surveys') {
                    tabContent.innerHTML = '<div class="text-center text-gray-600 p-8 text-lg">üìã Surveys coming soon</div>';
                } else if (state.activeTab === 'analytics') {
                    tabContent.innerHTML = '<div class="text-center text-gray-600 p-8 text-lg">üìä Analytics coming soon</div>';
                }
            } else if (state.currentView === 'childManagement') {
                app.innerHTML = renderChildManagement();
            } else if (state.currentView === 'assessment') {
                app.innerHTML = renderAssessment();
            } else if (state.currentView === 'childLearning') {
                app.innerHTML = renderChildLearning();
            } else if (state.currentView === 'childTutor') {
                app.innerHTML = renderChildTutor();
            }
        }

        render();
    </script>
</body>
</html>
