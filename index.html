bash
cat /mnt/user-data/outputs/panda-learning-hub.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PANDA Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'panda-blue': '#1E5A8E',
                        'panda-orange': '#F5A24A',
                        'panda-light-blue': '#7DB9DE',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-25px); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="m-0 p-0">
    <div id="app" class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50"></div>

    <script>
        // ============================================================================
        // STATE MANAGEMENT
        // ============================================================================
        const state = {
            currentView: 'opening',
            userRole: null,
            consentGiven: false,
            userId: null,
            preTestCompleted: false,
            currentDay: 1,
            journalEntries: [],
            activityProgress: {},
            childProgress: { correct: 0, total: 0 },
            currentQuestion: null,
            feedback: '',
            isListening: false,
            activeTab: 'coaching',
            // Child learning system
            children: [],
            activeChildId: null,
            currentSubject: null,
            currentLesson: null,
            assessmentInProgress: false,
            assessmentType: null, // 'pre' or 'post'
            learningData: {}, // Keyed by childId
            // Parent as Teacher mode
            teacherMode: true, // Show guided prompts for parents
            voiceEnabled: false,
            currentPrompt: null,
            showHints: true
        };

        // ============================================================================
        // CURRICULUM DATA
        // ============================================================================
        const curriculum = {
            colors: {
                name: 'Colors',
                icon: 'üé®',
                items: ['red', 'orange', 'yellow', 'green', 'blue', 'purple', 'black', 'white', 'gray', 'brown']
            },
            shapes: {
                name: 'Shapes', 
                icon: '‚¨õ',
                items: ['circle', 'square', 'rectangle', 'triangle', 'sphere', 'oval', 'star', 'heart']
            },
            letters: {
                name: 'Letters',
                icon: 'üìù',
                items: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').concat('abcdefghijklmnopqrstuvwxyz'.split(''))
            },
            numbers: {
                name: 'Numbers',
                icon: 'üî¢',
                items: Array.from({length: 20}, (_, i) => (i + 1).toString())
            },
            clothing: {
                name: 'Clothing',
                icon: 'üëï',
                items: ['shirt', 'pants', 'shoes', 'hat', 'socks', 'jacket', 'dress', 'scarf'],
                emojis: ['üëï', 'üëñ', 'üëü', 'üé©', 'üß¶', 'üß•', 'üëó', 'üß£']
            },
            household: {
                name: 'Household',
                icon: 'üè†',
                items: ['chair', 'table', 'bed', 'door', 'window', 'cup', 'spoon', 'brush'],
                emojis: ['ü™ë', 'ü™ë', 'üõèÔ∏è', 'üö™', 'ü™ü', '‚òï', 'ü•Ñ', 'ü™•']
            },
            animals: {
                name: 'Animals',
                icon: 'üêæ',
                items: ['dog', 'cat', 'bird', 'fish', 'cow', 'tree', 'flower', 'leaf'],
                emojis: ['üêï', 'üêà', 'üê¶', 'üê†', 'üêÑ', 'üå≥', 'üå∏', 'üçÉ']
            },
            opposites: {
                name: 'Opposites',
                icon: '‚ÜîÔ∏è',
                pairs: [
                    {a: 'big', b: 'small', emoji: ['üì¶', 'üì´']},
                    {a: 'hot', b: 'cold', emoji: ['üî•', '‚ùÑÔ∏è']},
                    {a: 'fast', b: 'slow', emoji: ['üêá', 'üê¢']},
                    {a: 'up', b: 'down', emoji: ['‚¨ÜÔ∏è', '‚¨áÔ∏è']},
                    {a: 'open', b: 'closed', emoji: ['üìÇ', 'üìÅ']}
                ]
            }
        };

        // ============================================================================
        // PARENT AS TEACHER PROMPTS
        // ============================================================================
        const teachingGuides = {
            colors: {
                introduction: "Today we're learning about colors! Colors are all around us and help us describe the world.",
                prompts: {
                    red: {
                        show: "Look at this red color! Can you point to it?",
                        say: "This is RED. Can you say 'red'?",
                        practice: "Let's find red things together! üçé What else is red?",
                        tips: "Point to red objects around the room. Say 'This apple is RED' or 'Your shirt is RED'",
                        hints: ["If struggling: Touch the red color and say 'RED' together", "Make it fun: 'Red like a fire truck!'", "Connect to emotions: 'Red means stop on traffic lights'"]
                    },
                    orange: {
                        show: "Look at this orange color!",
                        say: "This is ORANGE. Say 'orange' with me!",
                        practice: "Can you find something orange? üçä",
                        tips: "Show oranges, carrots, or orange toys",
                        hints: ["If struggling: 'Orange like a carrot or pumpkin'", "Sing: 'O-R-A-N-G-E spells orange!'"]
                    },
                    yellow: {
                        show: "Look at this bright yellow!",
                        say: "This is YELLOW. Can you say 'yellow'?",
                        practice: "What else is yellow? üåü",
                        tips: "Point to the sun, bananas, or yellow flowers",
                        hints: ["If struggling: 'Yellow like the sun!'", "Make connection: 'Lemons are yellow'"]
                    },
                    green: {
                        show: "See this green color?",
                        say: "This is GREEN. Say 'green'!",
                        practice: "Let's find green things! üåø",
                        tips: "Go outside and look at grass, leaves, trees",
                        hints: ["If struggling: 'Green like grass'", "Touch leaves: 'Feel this green leaf'"]
                    },
                    blue: {
                        show: "Look at this blue!",
                        say: "This is BLUE. Can you say 'blue'?",
                        practice: "What's blue around us? üíô",
                        tips: "Point to the sky, water, or blue clothing",
                        hints: ["If struggling: 'Blue like the sky'", "Sing: 'Blue, blue, I see something blue'"]
                    },
                    purple: {
                        show: "See this purple color?",
                        say: "This is PURPLE. Say 'purple'!",
                        practice: "Can you find purple? üíú",
                        tips: "Show grapes, eggplant, or purple flowers",
                        hints: ["If struggling: 'Purple like grapes'", "Mix colors: 'Red and blue make purple!'"]
                    },
                    black: {
                        show: "Look at black!",
                        say: "This is BLACK. Say 'black'!",
                        practice: "What's black?",
                        tips: "Point to text in books, night sky, or black objects",
                        hints: ["If struggling: 'Black like night time'", "Touch: 'Feel this black marker'"]
                    },
                    white: {
                        show: "See this white color?",
                        say: "This is WHITE. Can you say 'white'?",
                        practice: "Where's white?",
                        tips: "Point to paper, clouds, white clothing",
                        hints: ["If struggling: 'White like snow or clouds'", "Touch: 'This white paper'"]
                    },
                    gray: {
                        show: "Look at gray!",
                        say: "This is GRAY. Say 'gray'!",
                        practice: "Find gray things!",
                        tips: "Show elephants, clouds, rocks",
                        hints: ["If struggling: 'Gray like an elephant'", "Mix: 'Black and white make gray'"]
                    },
                    brown: {
                        show: "See this brown?",
                        say: "This is BROWN. Say 'brown'!",
                        practice: "What's brown around us?",
                        tips: "Point to wood, dirt, chocolate, teddy bears",
                        hints: ["If struggling: 'Brown like a teddy bear'", "Touch: 'Feel this brown tree bark'"]
                    }
                }
            },
            shapes: {
                introduction: "Let's explore shapes! Shapes are the forms of things around us.",
                prompts: {
                    circle: {
                        show: "Look at this circle! It's round and has no corners.",
                        say: "This is a CIRCLE. Say 'circle'!",
                        practice: "Let's find circles! Can you trace this circle with your finger? ‚≠ï",
                        tips: "Use plates, coins, wheels. Let them trace circles in the air.",
                        hints: ["If struggling: 'Round like a ball'", "Trace together: Follow the circle with your finger", "Find: 'Where are circles in this room?'"]
                    },
                    square: {
                        show: "See this square? It has 4 equal sides and 4 corners.",
                        say: "This is a SQUARE. Can you say 'square'?",
                        practice: "Count the sides: 1, 2, 3, 4! ‚óªÔ∏è",
                        tips: "Use blocks, windows, crackers. Count corners together.",
                        hints: ["If struggling: 'Four equal sides'", "Count: 'Let's count the corners: 1, 2, 3, 4'", "Compare: 'Different from a circle - it has corners!'"]
                    },
                    rectangle: {
                        show: "Look at this rectangle! It has 2 long sides and 2 short sides.",
                        say: "This is a RECTANGLE. Say 'rectangle'!",
                        practice: "Find rectangles! Books, doors, phones!",
                        tips: "Point to doors, books, phones, tables",
                        hints: ["If struggling: 'Like a long square'", "Touch: 'Feel the long side, now the short side'", "Compare: 'Longer than a square'"]
                    },
                    triangle: {
                        show: "See this triangle? It has 3 sides and 3 pointy corners.",
                        say: "This is a TRIANGLE. Say 'triangle'!",
                        practice: "Count the points: 1, 2, 3! üî∫",
                        tips: "Make triangle with hands, find in toys, pizza slices",
                        hints: ["If struggling: 'Three pointy corners'", "Make it: Use your fingers to make a triangle shape", "Count: 'One point, two points, three points!'"]
                    },
                    sphere: {
                        show: "Look at this sphere! It's like a 3D circle - round all around.",
                        say: "This is a SPHERE. Can you say 'sphere'?",
                        practice: "Roll it! Spheres can roll! üèÄ",
                        tips: "Use balls, oranges, globes. Let them roll it.",
                        hints: ["If struggling: 'Like a ball - round everywhere'", "Roll: 'Watch it roll!'", "Compare: 'A circle that's round all around'"]
                    },
                    oval: {
                        show: "See this oval? It's like a stretched circle - an egg shape!",
                        say: "This is an OVAL. Say 'oval'!",
                        practice: "Find ovals! Eggs, footballs!",
                        tips: "Show eggs, footballs, face shape",
                        hints: ["If struggling: 'Like an egg'", "Stretch: 'A circle that got stretched'", "Trace: 'Trace around this oval'"]
                    },
                    star: {
                        show: "Look at this star! It has points all around. ‚≠ê",
                        say: "This is a STAR. Say 'star'!",
                        practice: "Stars are in the sky at night! Can you make a star shape?",
                        tips: "Draw stars together, look at night sky, use stickers",
                        hints: ["If struggling: 'Twinkle twinkle little star'", "Count: 'How many points does our star have?'", "Draw: 'Let's draw a star together'"]
                    },
                    heart: {
                        show: "See this heart? It shows love! ‚ù§Ô∏è",
                        say: "This is a HEART. Say 'heart'!",
                        practice: "Hearts show we love something! Draw hearts in the air!",
                        tips: "Make heart with hands, draw hearts, talk about love",
                        hints: ["If struggling: 'I love you - draw a heart'", "Make it: 'Make a heart with your hands'", "Feel: 'Feel your heartbeat - that's your heart inside!'"]
                    }
                }
            },
            numbers: {
                introduction: "Let's count! Numbers help us know 'how many' of something we have.",
                prompts: {
                    '1': {
                        show: "Look! This is the number 1!",
                        say: "This is ONE. Say 'one'!",
                        practice: "Hold up 1 finger! Just one!",
                        tips: "Show one toy, one apple, one book",
                        hints: ["If struggling: 'Hold up one finger'", "Count: 'Just one! Only one!'", "Find: 'Show me one toy'"]
                    },
                    '2': {
                        show: "See the number 2?",
                        say: "This is TWO. Say 'two'!",
                        practice: "Hold up 2 fingers! Count them: 1, 2!",
                        tips: "Show pairs: two hands, two feet, two eyes",
                        hints: ["If struggling: 'Two like your two hands'", "Count: '1, 2 - two!'", "Find: 'You have two eyes, two ears'"]
                    },
                    '3': {
                        show: "Look at 3!",
                        say: "This is THREE. Say 'three'!",
                        practice: "Count 3 objects: 1, 2, 3!",
                        tips: "Count three toys, three crackers, three books",
                        hints: ["If struggling: 'One more than two'", "Count slowly: '1... 2... 3!'", "Clap: 'Clap three times!'"]
                    },
                    '4': {
                        show: "See number 4?",
                        say: "This is FOUR. Can you say 'four'?",
                        practice: "Count to 4! 1, 2, 3, 4!",
                        tips: "Four wheels on a car, four legs on a chair",
                        hints: ["If struggling: 'Count your fingers on one hand - stop at 4'", "Find: 'A chair has four legs'"]
                    },
                    '5': {
                        show: "Look at 5!",
                        say: "This is FIVE. Say 'five'!",
                        practice: "Show all fingers on one hand! Count: 1, 2, 3, 4, 5!",
                        tips: "Use one whole hand - five fingers!",
                        hints: ["If struggling: 'Five fingers on one hand'", "High five: 'Give me five!'", "Count toes: 'Five toes on one foot!'"]
                    },
                    '10': {
                        show: "This is 10!",
                        say: "This is TEN. Say 'ten'!",
                        practice: "Show all 10 fingers! Count them together!",
                        tips: "Use both hands - ten fingers total!",
                        hints: ["If struggling: 'All your fingers - that's ten!'", "Count: 'Let's count to 10 together'", "Song: 'Ten little fingers'"]
                    }
                }
            }
        };

        // ============================================================================
        // UTILITY FUNCTIONS
        // ============================================================================
        function logInteraction(action, data) {
            const logEntry = {
                timestamp: new Date().toISOString(),
                userId: state.userId,
                action: action,
                data: data
            };
            console.log('PANDA LOG:', logEntry);
        }

        // ============================================================================
        // VOICE INTERACTION SYSTEM
        // ============================================================================
        function speakText(text) {
            if (!state.voiceEnabled) return;
            
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9; // Slightly slower for clarity
                utterance.pitch = 1.1; // Slightly higher for child-friendly tone
                utterance.volume = 1;
                
                window.speechSynthesis.speak(utterance);
            }
        }

        function toggleVoice() {
            state.voiceEnabled = !state.voiceEnabled;
            if (state.voiceEnabled) {
                speakText("Voice guidance enabled! I'll help you teach.");
            }
            render();
        }

        function toggleTeacherMode() {
            state.teacherMode = !state.teacherMode;
            render();
        }

        function speakPrompt(promptType) {
            const subject = state.currentSubject;
            const item = state.currentLesson || Object.keys(state.learningData[state.activeChildId][subject]).filter(i => !state.learningData[state.activeChildId][subject][i].mastered)[0];
            
            if (!teachingGuides[subject] || !teachingGuides[subject].prompts[item]) return;
            
            const prompts = teachingGuides[subject].prompts[item];
            let textToSpeak = '';
            
            switch(promptType) {
                case 'show':
                    textToSpeak = prompts.show;
                    break;
                case 'say':
                    textToSpeak = prompts.say;
                    break;
                case 'practice':
                    textToSpeak = prompts.practice;
                    break;
                case 'tips':
                    textToSpeak = prompts.tips;
                    break;
            }
            
            speakText(textToSpeak);
        }

        function startVoiceRecognition() {
            if (!state.voiceEnabled) {
                alert('Please turn on Voice first by clicking the "üîä Voice On" button.');
                return;
            }

            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('‚ö†Ô∏è Voice recognition needs Chrome, Edge, or Safari browser.\n\nYour browser doesn\'t support voice commands, but you can still use the buttons!');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                state.isListening = true;
                speakText("I'm listening. You can say: help, correct, incorrect, or next.");
                render();
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.toLowerCase();
                console.log('Heard:', transcript);
                handleVoiceCommand(transcript);
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                state.isListening = false;
                if (event.error === 'no-speech') {
                    speakText("I didn't hear anything. Try again!");
                } else if (event.error === 'not-allowed') {
                    alert('‚ö†Ô∏è Microphone permission denied.\n\nPlease allow microphone access in your browser settings.');
                }
                render();
            };

            recognition.onend = function() {
                state.isListening = false;
                render();
            };

            try {
                recognition.start();
            } catch (e) {
                console.error('Failed to start recognition:', e);
                alert('Could not start voice recognition. Please try again.');
                state.isListening = false;
                render();
            }
        }

        function handleVoiceCommand(transcript) {
            console.log('Voice command:', transcript);
            
            // Check for help requests
            if (transcript.includes('help') || transcript.includes('hint') || transcript.includes('what do i say')) {
                const subject = state.currentSubject;
                const item = state.currentLesson || Object.keys(state.learningData[state.activeChildId][subject]).filter(i => !state.learningData[state.activeChildId][subject][i].mastered)[0];
                
                if (teachingGuides[subject] && teachingGuides[subject].prompts[item]) {
                    speakText(teachingGuides[subject].prompts[item].tips);
                }
                return;
            }
            
            // Check for navigation
            if (transcript.includes('next') || transcript.includes('skip')) {
                speakText("Moving to the next item");
                checkAnswer(false); // Mark as incorrect to move on
                return;
            }
            
            // Check for correct/incorrect marking
            if (transcript.includes('correct') || transcript.includes('right') || transcript.includes('yes')) {
                checkAnswer(true);
                return;
            }
            
            if (transcript.includes('wrong') || transcript.includes('incorrect') || transcript.includes('no')) {
                checkAnswer(false);
                return;
            }

            // Provide general guidance
            speakText("I didn't understand that. You can say 'correct', 'incorrect', 'help', or 'next'.");
        }

        function logInteraction(action, data) {
            const logEntry = {
                timestamp: new Date().toISOString(),
                userId: state.userId,
                action,
                data
            };
            console.log('Interaction logged:', logEntry);
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.pitch = 1.2;
                window.speechSynthesis.speak(utterance);
            }
        }

        // ============================================================================
        // ICON COMPONENTS (using SVG)
        // ============================================================================
        const icons = {
            brain: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>',
            users: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>',
            calendar: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>',
            fileText: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>',
            bookOpen: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>',
            barChart: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>',
            checkCircle: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
            home: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>',
            logout: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>',
            mic: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>',
            volume: '<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>'
        };

        // ============================================================================
        // COACHING TIPS DATA (Shortened for demo - add all 20)
        // ============================================================================
        const coachingTips = [
            {
                day: 1,
                title: "Building Neural Pathways Through Repetition",
                content: "Young children's brains form new neural connections through repeated exposure. When teaching colors, show the same color in multiple contexts throughout the day. The hippocampus, crucial for memory formation, strengthens these connections with each repetition.",
                practicalTip: "Point out 'red' items during meals, playtime, and outdoor walks. Say 'I see a red apple' or 'You're wearing a red shirt!' This multi-context exposure helps cement the concept."
            },
            {
                day: 2,
                title: "The Power of Multisensory Learning",
                content: "The brain processes sensory information in different regions. Combining visual, auditory, and tactile experiences creates multiple neural pathways to the same concept, making learning more robust and memorable.",
                practicalTip: "When teaching 'circle,' let your child touch round objects, trace circles with their finger, and say the word together. Try: 'Feel this round plate. Let's draw a circle in the air!'"
            },
            {
                day: 3,
                title: "Emotional Connection Enhances Memory",
                content: "The amygdala links emotions to memories. Positive emotional experiences trigger dopamine release, which strengthens neural connections and makes learning more effective and lasting.",
                practicalTip: "Celebrate discoveries with enthusiasm! When your child correctly identifies a shape, respond with genuine excitement: 'You found a triangle! High five!' This emotional reinforcement strengthens memory formation."
            }
        ];

        // ============================================================================
        // RENDER FUNCTIONS
        // ============================================================================
        function renderOpeningPage() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="max-w-4xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden">
                        <div class="p-12 text-center">
                            <!-- PANDA Logo -->
                            <div class="flex justify-center mb-8">
                                <div class="w-64 h-64 bg-gradient-to-br from-panda-light-blue to-panda-blue rounded-3xl flex items-center justify-center shadow-xl">
                                    <div class="text-center">
                                        <div class="text-6xl mb-2">üêºüìö</div>
                                        <div class="text-white font-bold text-2xl">PANDA</div>
                                        <div class="text-blue-100 text-sm">Study</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Title -->
                            <h1 class="text-5xl font-bold text-panda-blue mb-4">
                                PANDA Learning Hub
                            </h1>
                            <p class="text-xl text-gray-600 mb-2">University of North Carolina at Chapel Hill</p>
                            <p class="text-lg text-gray-500 mb-12">Department of Psychology & Neuroscience</p>

                            <!-- Welcome message -->
                            <div class="max-w-2xl mx-auto mb-12 text-left bg-gradient-to-r from-blue-50 to-orange-50 p-8 rounded-2xl border-2 border-panda-light-blue">
                                <h2 class="text-2xl font-semibold text-panda-blue mb-4">Welcome to the PANDA Study! üêº</h2>
                                <p class="text-lg text-gray-700 leading-relaxed mb-4">
                                    This research explores how parenting shapes early language and brain development in children aged 2-4. Through interactive, science-based activities, children learn colors and shapes while parents receive evidence-based coaching tips rooted in neuroscience research.
                                </p>
                                <p class="text-lg text-gray-700 leading-relaxed">
                                    Before we begin, we need your informed consent to participate in this research study.
                                </p>
                            </div>

                            <!-- Consent button -->
                            <button onclick="showConsent()" class="bg-panda-blue hover:bg-blue-800 text-white px-12 py-5 rounded-2xl text-xl font-semibold transform hover:scale-105 transition-all duration-200 shadow-lg">
                                Review Research Consent Form
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderConsentForm() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="max-w-4xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden" style="max-height: 90vh; display: flex; flex-direction: column;">
                        <div class="bg-panda-blue p-6">
                            <h2 class="text-3xl font-bold text-white">Research Study Consent Form</h2>
                            <p class="text-blue-100 mt-2">IRB Approval: 25-0805</p>
                        </div>

                        <div class="overflow-y-auto p-8 bg-white flex-1" onscroll="handleConsentScroll(event)">
                            <div class="max-w-3xl mx-auto space-y-6 text-gray-700">
                                <section>
                                    <h3 class="text-xl font-semibold text-panda-blue mb-3">Study Information</h3>
                                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                                        <p class="mb-2"><strong>Study Title:</strong> The PANDA Study (Parenting, Adversity, Neurodevelopment, & Developmental Assessment)</p>
                                        <p class="mb-2"><strong>Faculty Advisor:</strong> Dr. Margaret Sheridan</p>
                                        <p class="mb-2"><strong>Principal Investigator:</strong> Dr. Nathan Jorgensen</p>
                                        <p class="mb-2"><strong>Undergraduate Researcher:</strong> Rahiem Brooks</p>
                                        <p class="mb-2"><strong>Study Contact:</strong> Rahiem Brooks | <a href="mailto:rahiem@unc.edu" class="text-panda-blue underline">rahiem@unc.edu</a></p>
                                        <p><strong>Affiliation:</strong> University of North Carolina at Chapel Hill, Department of Psychology & Neuroscience</p>
                                    </div>
                                </section>

                                <section>
                                    <h3 class="text-xl font-semibold text-panda-blue mb-3">What is this study about?</h3>
                                    <p class="leading-relaxed">
                                        You are invited to participate in a research study on parenting and early childhood development. This study aims to better understand how different parenting experiences affect children's brain development, behavior, and learning‚Äîespecially for children between the ages of 0 and 5.
                                    </p>
                                </section>

                                <section>
                                    <h3 class="text-xl font-semibold text-panda-blue mb-3">Who can participate?</h3>
                                    <p class="leading-relaxed mb-3">To participate, you must:</p>
                                    <ul class="list-disc list-inside space-y-2 ml-4">
                                        <li>Be 18 years of age or older</li>
                                        <li>Be a parent or primary caregiver of a child between 0 and 5 years old</li>
                                        <li>Be able to read and understand English</li>
                                    </ul>
                                </section>

                                <section>
                                    <h3 class="text-xl font-semibold text-panda-blue mb-3">What will I be asked to do?</h3>
                                    <p class="leading-relaxed mb-3">
                                        If you agree to participate, you will complete a 10‚Äì15 minute online survey. You will be asked questions about your parenting practices, your child's behavior and learning, and some background information about you and your household.
                                    </p>
                                </section>

                                <section>
                                    <h3 class="text-xl font-semibold text-panda-blue mb-3">Is participation voluntary?</h3>
                                    <p class="leading-relaxed">
                                        Yes. Your participation is entirely voluntary. You may skip any question or stop the survey at any time, and there is no penalty for not participating.
                                    </p>
                                </section>

                                <section>
                                    <h3 class="text-xl font-semibold text-panda-blue mb-3">Will my answers be confidential?</h3>
                                    <p class="leading-relaxed">
                                        Yes. Your responses will be confidential and stored securely. Any identifying information (such as name or contact information) will be stored separately from your survey responses. Only the approved research team will have access to your information.
                                    </p>
                                </section>

                                <section>
                                    <h3 class="text-xl font-semibold text-panda-blue mb-3">Will I be contacted again?</h3>
                                    <p class="leading-relaxed mb-3">If you agree, we may contact you in the future about:</p>
                                    <ul class="list-disc list-inside space-y-2 ml-4">
                                        <li>Follow-up surveys</li>
                                        <li>Opportunities to participate in other parts of this study (such as parenting programs or educational tools)</li>
                                    </ul>
                                    <p class="leading-relaxed mt-3">
                                        You can opt out of future contact by emailing the study team.
                                    </p>
                                </section>

                                <section>
                                    <h3 class="text-xl font-semibold text-panda-blue mb-3">Are there any risks or benefits?</h3>
                                    <p class="leading-relaxed mb-3">
                                        <strong>Risks:</strong> There are no known risks associated with this study beyond those of daily life.
                                    </p>
                                    <p class="leading-relaxed">
                                        <strong>Benefits:</strong> While you may not directly benefit, your responses will help researchers design better tools to support child development and learning, particularly for families facing economic or social challenges.
                                    </p>
                                </section>

                                <section>
                                    <h3 class="text-xl font-semibold text-panda-blue mb-3">Who do I contact with questions?</h3>
                                    <p class="leading-relaxed mb-3">
                                        If you have questions now or later, contact <strong>Rahiem Brooks, Study Coordinator:</strong> <a href="mailto:rahiem@unc.edu" class="text-panda-blue underline">rahiem@unc.edu</a>
                                    </p>
                                    <p class="leading-relaxed">
                                        You may also contact the UNC IRB at <strong>919-966-3113</strong> or <a href="mailto:IRB_subjects@unc.edu" class="text-panda-blue underline">IRB_subjects@unc.edu</a> if you have questions about your rights as a research participant.
                                    </p>
                                </section>

                                <section class="bg-orange-50 p-6 rounded-lg border-2 border-panda-orange">
                                    <h3 class="text-xl font-semibold text-panda-blue mb-3">Statement of Consent</h3>
                                    <p class="leading-relaxed font-semibold mb-3">By selecting "I agree" below:</p>
                                    <ul class="list-disc list-inside space-y-2 ml-4">
                                        <li>I am 18 years old or older</li>
                                        <li>I have read the information above and voluntarily agree to participate</li>
                                        <li>I agree that the research team may contact me in the future about related studies</li>
                                    </ul>
                                </section>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-6 border-t border-gray-200">
                            <div class="max-w-3xl mx-auto">
                                <label class="flex items-start gap-3 mb-6 cursor-pointer">
                                    <input type="checkbox" id="consentCheckbox" class="mt-1 w-5 h-5 rounded border-gray-300 text-panda-blue focus:ring-panda-blue" onchange="updateConsentButton()">
                                    <span class="text-gray-700">
                                        I am 18 years old or older. I have read the information above and voluntarily agree to participate. I agree that the research team may contact me in the future about related studies.
                                    </span>
                                </label>

                                <div id="scrollWarning" class="text-sm text-panda-orange mb-4 text-center font-semibold">
                                    Please scroll to the bottom to review all information before consenting
                                </div>

                                <div class="flex gap-4">
                                    <button onclick="backToOpening()" class="flex-1 bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-semibold hover:bg-gray-300 transition-colors">
                                        Back
                                    </button>
                                    <button id="consentButton" onclick="acceptConsent()" disabled class="flex-1 px-6 py-3 rounded-xl font-semibold transition-all bg-gray-300 text-gray-500 cursor-not-allowed">
                                        I Consent to Participate
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRoleSelection() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="max-w-5xl w-full">
                        <h2 class="text-4xl font-bold text-center mb-12 text-panda-blue">
                            Who's using PANDA today?
                        </h2>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- Parent Button -->
                            <button onclick="selectRole('parent')" class="group bg-white rounded-3xl p-12 shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all duration-300 border-4 border-transparent hover:border-panda-blue">
                                <div class="w-32 h-32 mx-auto mb-6 bg-panda-blue rounded-3xl flex items-center justify-center group-hover:rotate-6 transition-transform">
                                    <div class="w-16 h-16 text-white">${icons.users}</div>
                                </div>
                                <h3 class="text-3xl font-bold text-panda-blue mb-4">Parents</h3>
                                <p class="text-gray-600 text-lg">
                                    Access coaching tips, track progress, and journal your child's learning journey
                                </p>
                            </button>

                            <!-- Child Button -->
                            <button onclick="selectRole('child')" class="group bg-white rounded-3xl p-12 shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all duration-300 border-4 border-transparent hover:border-panda-orange">
                                <div class="w-32 h-32 mx-auto mb-6 bg-panda-orange rounded-3xl flex items-center justify-center group-hover:rotate-6 transition-transform">
                                    <div class="w-16 h-16 text-white">${icons.brain}</div>
                                </div>
                                <h3 class="text-3xl font-bold text-panda-blue mb-4">Children</h3>
                                <p class="text-gray-600 text-lg">
                                    Learn colors and shapes with your friendly AI tutor! üé®
                                </p>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderParentDashboard() {
            return `
                <div class="min-h-screen p-4 md:p-8">
                    <div class="max-w-7xl mx-auto">
                        <!-- Header -->
                        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h1 class="text-3xl font-bold text-panda-blue">Parent Dashboard</h1>
                                    <p class="text-gray-600">Day ${state.currentDay} of 20</p>
                                </div>
                                <button onclick="resetApp()" class="flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-colors">
                                    <div class="w-5 h-5">${icons.logout}</div>
                                    Exit
                                </button>
                            </div>
                        </div>

                        <!-- Navigation Tabs -->
                        <div class="bg-white rounded-2xl shadow-lg mb-6">
                            <div class="flex overflow-x-auto">
                                <button onclick="setActiveTab('coaching')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap rounded-tl-2xl ${state.activeTab === 'coaching' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    <div class="w-5 h-5">${icons.brain}</div>
                                    Coaching Tips
                                </button>
                                <button onclick="setActiveTab('labeling')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'labeling' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                    </svg>
                                    Home Labeling
                                </button>
                                <button onclick="setActiveTab('calendar')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'calendar' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    <div class="w-5 h-5">${icons.calendar}</div>
                                    Learning Calendar
                                </button>
                                <button onclick="setActiveTab('journal')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'journal' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    <div class="w-5 h-5">${icons.fileText}</div>
                                    Journal
                                </button>
                                <button onclick="setActiveTab('resources')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'resources' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    Resources
                                </button>
                                <button onclick="setActiveTab('surveys')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'surveys' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    <div class="w-5 h-5">${icons.bookOpen}</div>
                                    Surveys
                                </button>
                                <button onclick="setActiveTab('analytics')" class="flex items-center gap-2 px-6 py-4 font-semibold transition-colors whitespace-nowrap ${state.activeTab === 'analytics' ? 'bg-panda-blue text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                    <div class="w-5 h-5">${icons.barChart}</div>
                                    Progress
                                </button>
                            </div>
                        </div>

                        <!-- Content Area -->
                        <div class="bg-white rounded-2xl shadow-lg p-6">
                            <div id="tabContent"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderJournal() {
            const prompts = [
                "Today's activity felt...",
                "My child seemed most engaged when...",
                "The difficulty level was...",
                "I noticed my child...",
                "What worked well today was...",
                "A challenge we faced was...",
                "My child's favorite part was...",
                "I'm feeling...",
                "Progress I've noticed...",
                "Today we learned..."
            ];
            
            const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
            
            return `
                <div class="max-w-4xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-panda-blue">Learning Journal</h2>
                        <div class="flex gap-3">
                            <button onclick="emailJournal()" class="flex items-center gap-2 px-5 py-2.5 bg-panda-blue text-white rounded-xl hover:bg-blue-800 transition-colors font-semibold whitespace-nowrap">
                                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                                <span>Email Notes</span>
                            </button>
                            <button onclick="exportJournal()" class="flex items-center gap-2 px-5 py-2.5 bg-panda-orange text-white rounded-xl hover:bg-orange-600 transition-colors font-semibold whitespace-nowrap">
                                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                <span>Export Notes</span>
                            </button>
                        </div>
                    </div>

                    <!-- Research Notice -->
                    <div class="bg-blue-50 border-l-4 border-panda-blue p-4 mb-6 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="w-5 h-5 text-panda-blue flex-shrink-0 mt-0.5">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-sm text-gray-700">
                                    <strong>Research Note:</strong> Your journal entries will be available to the research team for analysis. This helps us understand parent experiences and improve future learning programs.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- New Entry Form -->
                    <div class="bg-gradient-to-br from-blue-50 to-orange-50 rounded-2xl p-6 mb-6 border-2 border-panda-light-blue">
                        <h3 class="text-lg font-semibold text-panda-blue mb-4">Add New Journal Entry</h3>
                        
                        <!-- Guided Prompt -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <span class="text-panda-orange">‚ú® Reflection prompt:</span> <span class="italic">"${randomPrompt}"</span>
                            </label>
                            <p class="text-xs text-gray-600 mb-3">
                                Consider: Was today's activity easy or challenging? How are you feeling about the learning process? What did you notice?
                            </p>
                        </div>

                        <textarea 
                            id="journalEntry" 
                            placeholder="Share your thoughts about today's learning activity..."
                            class="w-full h-32 p-4 border-2 border-gray-300 rounded-xl focus:border-panda-blue focus:outline-none resize-none text-gray-700"
                        ></textarea>
                        
                        <div class="flex justify-between items-center mt-4">
                            <button onclick="changePrompt()" class="text-sm text-panda-blue hover:underline font-medium">
                                ‚Üª Try a different prompt
                            </button>
                            <button onclick="addJournalEntry()" class="flex items-center gap-2 px-6 py-3 bg-panda-blue text-white rounded-xl hover:bg-blue-800 transition-colors font-semibold shadow-md whitespace-nowrap">
                                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Save Entry</span>
                            </button>
                        </div>
                    </div>

                    <!-- Previous Entries -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Previous Entries (${state.journalEntries.length})</h3>
                        <div id="journalEntriesList">
                            ${state.journalEntries.length === 0 ? `
                                <div class="text-center py-12 text-gray-500 bg-gray-50 rounded-xl">
                                    <div class="w-16 h-16 mx-auto mb-4 text-gray-400">${icons.fileText}</div>
                                    <p class="text-lg">No journal entries yet</p>
                                    <p class="text-sm mt-2">Start documenting your child's learning journey!</p>
                                </div>
                            ` : state.journalEntries.map(entry => `
                                <div class="bg-white border-2 border-gray-200 rounded-xl p-6 mb-4 hover:shadow-md transition-shadow">
                                    <div class="flex justify-between items-start mb-3">
                                        <span class="bg-panda-blue text-white px-3 py-1 rounded-full text-sm font-semibold">
                                            Day ${entry.day}
                                        </span>
                                        <span class="text-sm text-gray-500">
                                            ${new Date(entry.timestamp).toLocaleDateString()} at ${new Date(entry.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                        </span>
                                    </div>
                                    <p class="text-gray-700 leading-relaxed whitespace-pre-wrap">${entry.text}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function addJournalEntry() {
            const entryText = document.getElementById('journalEntry').value.trim();
            
            if (!entryText) {
                alert('Please write something before saving your entry.');
                return;
            }

            const newEntry = {
                id: Date.now(),
                userId: state.userId,
                day: state.currentDay,
                text: entryText,
                timestamp: new Date().toISOString()
            };

            state.journalEntries.unshift(newEntry);
            logInteraction('journal_entry_added', newEntry);
            
            // Clear the textarea
            document.getElementById('journalEntry').value = '';
            
            // Re-render the journal tab
            render();
        }

        function changePrompt() {
            // Re-render to get a new random prompt
            render();
        }

        function exportJournal() {
            const exportData = {
                userId: state.userId,
                participantInfo: {
                    totalEntries: state.journalEntries.length,
                    currentDay: state.currentDay,
                    exportDate: new Date().toISOString()
                },
                entries: state.journalEntries.map(entry => ({
                    day: entry.day,
                    date: new Date(entry.timestamp).toLocaleDateString(),
                    time: new Date(entry.timestamp).toLocaleTimeString(),
                    content: entry.text
                }))
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `panda-journal-${state.userId}-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            logInteraction('journal_exported', { entryCount: state.journalEntries.length });
            
            alert(`Journal exported! ${state.journalEntries.length} entries saved.`);
        }

        function emailJournal() {
            if (state.journalEntries.length === 0) {
                alert('You have no journal entries to email yet.');
                return;
            }

            // Format entries for email
            let emailBody = `PANDA Study Learning Journal%0D%0A`;
            emailBody += `Participant ID: ${state.userId}%0D%0A`;
            emailBody += `Total Entries: ${state.journalEntries.length}%0D%0A`;
            emailBody += `Current Day: ${state.currentDay} of 20%0D%0A`;
            emailBody += `Export Date: ${new Date().toLocaleDateString()}%0D%0A%0D%0A`;
            emailBody += `=====================================%0D%0A%0D%0A`;
            
            state.journalEntries.forEach((entry, index) => {
                emailBody += `Entry ${state.journalEntries.length - index}:%0D%0A`;
                emailBody += `Day: ${entry.day}%0D%0A`;
                emailBody += `Date: ${new Date(entry.timestamp).toLocaleDateString()} at ${new Date(entry.timestamp).toLocaleTimeString()}%0D%0A`;
                emailBody += `%0D%0A${entry.text}%0D%0A`;
                emailBody += `-------------------------------------%0D%0A%0D%0A`;
            });

            const subject = `PANDA Study Journal - ${state.journalEntries.length} Entries`;
            const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${emailBody}`;
            
            window.location.href = mailtoLink;
            
            logInteraction('journal_emailed', { entryCount: state.journalEntries.length });
        }

        function renderResources() {
            return `
                <div class="max-w-5xl mx-auto">
                    <div class="mb-6">
                        <h2 class="text-3xl font-bold text-panda-blue mb-3">Family Resources & Support</h2>
                        <p class="text-gray-600 text-lg">Tools and information to support your family's learning and development</p>
                    </div>

                    <!-- Home Labeling Guide - Featured Resource -->
                    <div class="bg-gradient-to-br from-blue-50 to-orange-50 border-2 border-panda-blue rounded-2xl p-8 mb-8">
                        <div class="flex items-start gap-4 mb-6">
                            <div class="w-16 h-16 bg-panda-blue rounded-full flex items-center justify-center flex-shrink-0">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-2xl font-bold text-panda-blue mb-2">Home Labeling Guide</h3>
                                <p class="text-gray-700 text-lg mb-4">
                                    Turn your home into a learning environment by labeling everyday objects. Research shows this simple practice builds vocabulary, supports early literacy, and strengthens memory formation.
                                </p>
                                <button onclick="toggleLabelingGuide()" id="labelingGuideBtn" class="flex items-center gap-2 px-6 py-3 bg-panda-blue text-white rounded-xl hover:bg-blue-800 transition-colors font-semibold">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                    <span>View Complete Labeling Guide</span>
                                </button>
                            </div>
                        </div>

                        <!-- Expandable Labeling Guide Content -->
                        <div id="labelingGuideContent" class="hidden mt-6 space-y-6">
                            <!-- Why Labeling Works -->
                            <div class="bg-white rounded-xl p-6 border-2 border-panda-light-blue">
                                <h4 class="text-xl font-bold text-panda-blue mb-3 flex items-center gap-2">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                    </svg>
                                    Why Home Labeling Works: The Neuroscience
                                </h4>
                                <div class="space-y-3 text-gray-700">
                                    <p><strong>üí≠ Shapes Memories:</strong> The brain uses the same areas for creating memories and identifying places. A labeled home creates meaningful learning experiences throughout daily life.</p>
                                    <p><strong>üòä Influences Emotions:</strong> Your home environment is tied to emotional states. "Home-activated neurons" help with anxiety reduction and emotional comfort‚Äîa well-organized, labeled space supports mental well-being.</p>
                                    <p><strong>üëÅÔ∏è Guides Attention:</strong> Labels help the brain filter information and focus on what's important, reducing cognitive load and improving learning efficiency.</p>
                                    <p><strong>üéØ Supports Self-Regulation:</strong> When rooms have clear purposes, children understand expectations better. "This is the BEDROOM‚Äîwe use quiet voices" helps guide behavior.</p>
                                    <p><strong>üè† Creates Safety & Belonging:</strong> Predictable, organized spaces meet our fundamental need for security, which is essential for learning and emotional health.</p>
                                    <p><strong>‚ú® Builds Identity:</strong> Including cultural items and family traditions in your labeling reflects your values and heritage, making learning personally meaningful.</p>
                                </div>
                            </div>

                            <!-- Labeling Methods -->
                            <div class="bg-white rounded-xl p-6 border-2 border-panda-orange">
                                <h4 class="text-xl font-bold text-panda-blue mb-3 flex items-center gap-2">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                                    </svg>
                                    Budget-Friendly Labeling Methods
                                </h4>
                                <p class="text-gray-700 mb-4">All methods work equally well for learning! Choose what fits your budget and resources:</p>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <p class="font-semibold text-panda-blue mb-2">‚úèÔ∏è Method 1: Paper & Tape</p>
                                        <p class="text-sm text-gray-700">Cut paper into strips, write words with marker or pen, tape to objects with any tape you have.</p>
                                    </div>
                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <p class="font-semibold text-panda-blue mb-2">üñ®Ô∏è Method 2: Print at Home</p>
                                        <p class="text-sm text-gray-700">Type words in large font (size 24-36), print on regular paper, cut out, and tape to objects.</p>
                                    </div>
                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <p class="font-semibold text-panda-blue mb-2">üìÑ Method 3: Printable Labels</p>
                                        <p class="text-sm text-gray-700">Use printable label sheets (like Avery) if available‚Äîpeel and stick directly to objects.</p>
                                    </div>
                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <p class="font-semibold text-panda-blue mb-2">üõí Method 4: Order Labels</p>
                                        <p class="text-sm text-gray-700">Purchase adhesive labels or label maker online if budget allows for longer-lasting labels.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Kitchen & Dining Room -->
                            <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                                <h4 class="text-xl font-bold text-panda-blue mb-3">üçΩÔ∏è Kitchen & Dining Room</h4>
                                <p class="text-gray-700 mb-4">Children spend significant time in eating areas. Label items they see and use daily:</p>
                                <div class="mb-4">
                                    <p class="font-semibold text-gray-800 mb-2">Common Items to Label:</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${['TABLE', 'CHAIR', 'PLATE', 'BOWL', 'CUP', 'GLASS', 'SPOON', 'FORK', 'KNIFE', 'NAPKIN', 'REFRIGERATOR', 'STOVE', 'OVEN', 'SINK', 'FAUCET', 'CABINET', 'DRAWER', 'MICROWAVE', 'DISHWASHER', 'TRASH CAN', 'COUNTER', 'WINDOW', 'DOOR', 'LIGHT', 'WATER'].map(item => `<span class="bg-blue-100 text-panda-blue px-3 py-1 rounded-full text-sm font-medium">${item}</span>`).join('')}
                                    </div>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-800 mb-2">Cultural Items (Add what applies to your family):</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${['WOK', 'RICE COOKER', 'TIFFIN', 'CHAPATI PAN', 'COMAL', 'TORTILLERA', 'MOLCAJETE', 'MORTAR & PESTLE', 'TAGINE', 'SAMOVAR', 'STEAMER', 'CLAY POT', 'PRESSURE COOKER', 'TANDOOR', 'TEAPOT'].map(item => `<span class="bg-orange-100 text-panda-orange px-3 py-1 rounded-full text-sm font-medium">${item}</span>`).join('')}
                                    </div>
                                </div>
                            </div>

                            <!-- Living Room -->
                            <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                                <h4 class="text-xl font-bold text-panda-blue mb-3">üõãÔ∏è Living Room</h4>
                                <p class="text-gray-700 mb-4">Central family spaces where children play and observe:</p>
                                <div class="mb-4">
                                    <p class="font-semibold text-gray-800 mb-2">Common Items to Label:</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${['COUCH', 'SOFA', 'CHAIR', 'TV', 'TELEVISION', 'REMOTE', 'LAMP', 'LIGHT', 'TABLE', 'RUG', 'CARPET', 'BOOKSHELF', 'BOOKS', 'WINDOW', 'DOOR', 'CURTAINS', 'BLINDS', 'PILLOW', 'BLANKET', 'PICTURE', 'PHOTO', 'PLANT', 'TOY BOX', 'TOYS', 'CEILING', 'WALL', 'FLOOR'].map(item => `<span class="bg-blue-100 text-panda-blue px-3 py-1 rounded-full text-sm font-medium">${item}</span>`).join('')}
                                    </div>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-800 mb-2">Cultural Items (Add what applies to your family):</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${['PRAYER RUG', 'ALTAR', 'SHRINE', 'TAPESTRY', 'HAMMOCK', 'FLOOR CUSHIONS', 'KOTATSU', 'FUTON', 'DIWAN', 'TRADITIONAL ART', 'INCENSE HOLDER', 'MENORAH', 'PRAYER BEADS', 'DREAMCATCHER', 'PAPEL PICADO', 'IKEBANA', 'RANGOLI SUPPLIES'].map(item => `<span class="bg-orange-100 text-panda-orange px-3 py-1 rounded-full text-sm font-medium">${item}</span>`).join('')}
                                    </div>
                                </div>
                            </div>

                            <!-- Bedroom -->
                            <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                                <h4 class="text-xl font-bold text-panda-blue mb-3">üõèÔ∏è Bedroom</h4>
                                <p class="text-gray-700 mb-4">Personal spaces for rest and daily routines:</p>
                                <div class="mb-4">
                                    <p class="font-semibold text-gray-800 mb-2">Common Items to Label:</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${['BED', 'PILLOW', 'BLANKET', 'SHEET', 'COMFORTER', 'DRESSER', 'CLOSET', 'DOOR', 'WINDOW', 'CURTAINS', 'LIGHT', 'LAMP', 'MIRROR', 'CLOCK', 'CLOTHES', 'SHIRT', 'PANTS', 'SHOES', 'SOCKS', 'TOYS', 'BOOKS', 'NIGHTSTAND', 'HAMPER', 'HANGER'].map(item => `<span class="bg-blue-100 text-panda-blue px-3 py-1 rounded-full text-sm font-medium">${item}</span>`).join('')}
                                    </div>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-800 mb-2">Cultural Items (Add what applies to your family):</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${['FUTON', 'TATAMI MAT', 'MOSQUITO NET', 'DREAMCATCHER', 'PRAYER MAT', 'SPECIAL BEDDING', 'TRADITIONAL QUILT', 'STORAGE TRUNK', 'FLOOR MATTRESS'].map(item => `<span class="bg-orange-100 text-panda-orange px-3 py-1 rounded-full text-sm font-medium">${item}</span>`).join('')}
                                    </div>
                                </div>
                            </div>

                            <!-- Bathroom -->
                            <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                                <h4 class="text-xl font-bold text-panda-blue mb-3">üöø Bathroom</h4>
                                <p class="text-gray-700 mb-4">Self-care spaces where children learn hygiene routines:</p>
                                <div class="mb-4">
                                    <p class="font-semibold text-gray-800 mb-2">Common Items to Label:</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${['TOILET', 'SINK', 'BATHTUB', 'SHOWER', 'FAUCET', 'MIRROR', 'TOWEL', 'WASHCLOTH', 'SOAP', 'SHAMPOO', 'CONDITIONER', 'TOOTHBRUSH', 'TOOTHPASTE', 'BRUSH', 'COMB', 'MEDICINE CABINET', 'TOILET PAPER', 'DRAIN', 'MAT', 'WATER'].map(item => `<span class="bg-blue-100 text-panda-blue px-3 py-1 rounded-full text-sm font-medium">${item}</span>`).join('')}
                                    </div>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-800 mb-2">Cultural Items (Add what applies to your family):</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${['BIDET', 'LOTA', 'BODNA', 'HAMMAM BOWL', 'TRADITIONAL OILS', 'SPECIFIC GROOMING TOOLS'].map(item => `<span class="bg-orange-100 text-panda-orange px-3 py-1 rounded-full text-sm font-medium">${item}</span>`).join('')}
                                    </div>
                                </div>
                            </div>

                            <!-- Tips for Success -->
                            <div class="bg-gradient-to-r from-green-50 to-teal-50 rounded-xl p-6 border-2 border-green-400">
                                <h4 class="text-xl font-bold text-panda-blue mb-3">üí° Tips for Success</h4>
                                <ul class="space-y-2 text-gray-700">
                                    <li><strong>Start small:</strong> Begin with 10-15 labels in one room, then expand.</li>
                                    <li><strong>Point and read:</strong> Touch labels while saying words during daily activities: "Let's sit on the CHAIR."</li>
                                    <li><strong>Make it interactive:</strong> Ask "Can you find the label that says SPOON?" or "What does this say?"</li>
                                    <li><strong>Use large, clear letters:</strong> Print or write in uppercase letters, size 1-2 inches tall.</li>
                                    <li><strong>Place at child's eye level:</strong> Labels should be easy for children to see.</li>
                                    <li><strong>Replace worn labels:</strong> Check weekly and replace faded or torn labels.</li>
                                    <li><strong>Add new labels gradually:</strong> Introduce 3-5 new labels each week to maintain interest.</li>
                                    <li><strong>Include cultural items:</strong> Label items unique to your heritage‚Äîthis validates identity and enriches vocabulary.</li>
                                    <li><strong>Create zones:</strong> Label areas like "PLAY AREA," "QUIET CORNER," "READING SPACE" to guide behavior.</li>
                                    <li><strong>Be consistent:</strong> Use labels in daily conversation for maximum learning benefit.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Other Resources Coming Soon -->
                    <div class="bg-gradient-to-br from-orange-50 to-blue-50 border-2 border-panda-orange rounded-2xl p-8 mb-6">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-panda-orange rounded-full flex items-center justify-center flex-shrink-0">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-panda-blue mb-2">More Resources Coming Soon!</h3>
                                <p class="text-gray-700 leading-relaxed mb-3">
                                    We're building a comprehensive library to support families. Future resources will include:
                                </p>
                                <ul class="space-y-2 text-gray-700 text-sm">
                                    <li>üèõÔ∏è <strong>Free Museum Access:</strong> Programs offering free admission for low-income families</li>
                                    <li>üìö <strong>Parenting Courses:</strong> No-cost online parenting education programs</li>
                                    <li>üíª <strong>Educational Programs:</strong> Online learning platforms with fee waivers for children</li>
                                    <li>ü§ù <strong>Community Services:</strong> Local resources for families in need</li>
                                    <li>üí∞ <strong>Financial Assistance:</strong> Programs to help with childcare and educational materials</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="mt-8 bg-blue-50 border-l-4 border-panda-blue rounded-lg p-6">
                        <h4 class="font-semibold text-panda-blue mb-2">Have a resource to suggest?</h4>
                        <p class="text-gray-700 text-sm">
                            If you know of valuable resources that should be included here, please contact us at <a href="mailto:rahiem@unc.edu" class="text-panda-blue underline font-medium">rahiem@unc.edu</a>
                        </p>
                    </div>
                </div>
            `;
        }

        function toggleLabelingGuide() {
            const content = document.getElementById('labelingGuideContent');
            const btn = document.getElementById('labelingGuideBtn');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                btn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                    </svg>
                    <span>Hide Labeling Guide</span>
                `;
            } else {
                content.classList.add('hidden');
                btn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                    <span>View Complete Labeling Guide</span>
                `;
            }
        }

        function renderLabelingGuide() {
            return `
                <div class="max-w-5xl mx-auto">
                    <div class="mb-6">
                        <h2 class="text-3xl font-bold text-panda-blue mb-3">Home Labeling Guide</h2>
                        <p class="text-gray-600 text-lg">Transform your home into a learning environment that supports your child's vocabulary and brain development</p>
                    </div>

                    <!-- Why Labeling Works -->
                    <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl p-8 border-2 border-panda-light-blue mb-6">
                        <h3 class="text-2xl font-bold text-panda-blue mb-4 flex items-center gap-2">
                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            Why Home Labeling Works: The Neuroscience
                        </h3>
                        <div class="grid md:grid-cols-2 gap-4 text-gray-700">
                            <div class="bg-white p-4 rounded-xl">
                                <p class="font-semibold text-panda-blue mb-2">üí≠ Shapes Memories</p>
                                <p class="text-sm">The brain uses the same areas for creating memories and identifying places. A labeled home creates meaningful learning experiences throughout daily life.</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl">
                                <p class="font-semibold text-panda-blue mb-2">üòä Influences Emotions</p>
                                <p class="text-sm">"Home-activated neurons" help with anxiety reduction and comfort‚Äîa well-organized, labeled space supports mental well-being.</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl">
                                <p class="font-semibold text-panda-blue mb-2">üëÅÔ∏è Guides Attention</p>
                                <p class="text-sm">Labels help the brain filter information and focus on what's important, reducing cognitive load and improving learning efficiency.</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl">
                                <p class="font-semibold text-panda-blue mb-2">üéØ Supports Self-Regulation</p>
                                <p class="text-sm">Clear room purposes help children understand expectations. "This is the BEDROOM‚Äîwe use quiet voices."</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl">
                                <p class="font-semibold text-panda-blue mb-2">üè† Creates Safety</p>
                                <p class="text-sm">Predictable, organized spaces meet our fundamental need for security, essential for learning and emotional health.</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl">
                                <p class="font-semibold text-panda-blue mb-2">‚ú® Builds Identity</p>
                                <p class="text-sm">Including cultural items reflects your values and heritage, making learning personally meaningful.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Labeling Methods -->
                    <div class="bg-white rounded-2xl p-6 border-2 border-panda-orange mb-6">
                        <h3 class="text-2xl font-bold text-panda-blue mb-4 flex items-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                            </svg>
                            Budget-Friendly Labeling Methods
                        </h3>
                        <p class="text-gray-700 mb-4 text-lg">All methods work equally well for learning! Choose what fits your budget and resources:</p>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-5 rounded-xl border-2 border-blue-200">
                                <p class="font-bold text-panda-blue mb-2 text-lg">‚úèÔ∏è Method 1: Paper & Tape</p>
                                <p class="text-gray-700">Cut paper into strips, write words with marker or pen, tape to objects with any tape you have.</p>
                            </div>
                            <div class="bg-blue-50 p-5 rounded-xl border-2 border-blue-200">
                                <p class="font-bold text-panda-blue mb-2 text-lg">üñ®Ô∏è Method 2: Print at Home</p>
                                <p class="text-gray-700">Type words in large font (size 24-36), print on regular paper, cut out, and tape to objects.</p>
                            </div>
                            <div class="bg-blue-50 p-5 rounded-xl border-2 border-blue-200">
                                <p class="font-bold text-panda-blue mb-2 text-lg">üìÑ Method 3: Printable Labels</p>
                                <p class="text-gray-700">Use printable label sheets (like Avery) if available‚Äîpeel and stick directly to objects.</p>
                            </div>
                            <div class="bg-blue-50 p-5 rounded-xl border-2 border-blue-200">
                                <p class="font-bold text-panda-blue mb-2 text-lg">üõí Method 4: Order Labels</p>
                                <p class="text-gray-700">Purchase adhesive labels or label maker online if budget allows for longer-lasting labels.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Kitchen & Dining Room -->
                    <div class="bg-white rounded-2xl p-6 border-2 border-gray-300 mb-6">
                        <h3 class="text-2xl font-bold text-panda-blue mb-4">üçΩÔ∏è Kitchen & Dining Room</h3>
                        <p class="text-gray-700 mb-4">Children spend significant time in eating areas. Label items they see and use daily:</p>
                        <div class="mb-5">
                            <p class="font-semibold text-gray-800 mb-3 text-lg">Common Items to Label:</p>
                            <div class="flex flex-wrap gap-2">
                                ${['TABLE', 'CHAIR', 'PLATE', 'BOWL', 'CUP', 'GLASS', 'SPOON', 'FORK', 'KNIFE', 'NAPKIN', 'REFRIGERATOR', 'STOVE', 'OVEN', 'SINK', 'FAUCET', 'CABINET', 'DRAWER', 'MICROWAVE', 'DISHWASHER', 'TRASH CAN', 'COUNTER', 'WINDOW', 'DOOR', 'LIGHT', 'WATER'].map(item => `<span class="bg-blue-100 text-panda-blue px-3 py-1.5 rounded-full text-sm font-semibold">${item}</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 mb-3 text-lg">Cultural Items (Add what applies to your family):</p>
                            <div class="flex flex-wrap gap-2">
                                ${['WOK', 'RICE COOKER', 'TIFFIN', 'CHAPATI PAN', 'COMAL', 'TORTILLERA', 'MOLCAJETE', 'MORTAR & PESTLE', 'TAGINE', 'SAMOVAR', 'STEAMER', 'CLAY POT', 'PRESSURE COOKER', 'TEAPOT'].map(item => `<span class="bg-orange-100 text-panda-orange px-3 py-1.5 rounded-full text-sm font-semibold">${item}</span>`).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Living Room -->
                    <div class="bg-white rounded-2xl p-6 border-2 border-gray-300 mb-6">
                        <h3 class="text-2xl font-bold text-panda-blue mb-4">üõãÔ∏è Living Room</h3>
                        <p class="text-gray-700 mb-4">Central family spaces where children play and observe:</p>
                        <div class="mb-5">
                            <p class="font-semibold text-gray-800 mb-3 text-lg">Common Items to Label:</p>
                            <div class="flex flex-wrap gap-2">
                                ${['COUCH', 'SOFA', 'CHAIR', 'TV', 'TELEVISION', 'REMOTE', 'LAMP', 'LIGHT', 'TABLE', 'RUG', 'CARPET', 'BOOKSHELF', 'BOOKS', 'WINDOW', 'DOOR', 'CURTAINS', 'BLINDS', 'PILLOW', 'BLANKET', 'PICTURE', 'PHOTO', 'PLANT', 'TOY BOX', 'TOYS', 'CEILING', 'WALL', 'FLOOR'].map(item => `<span class="bg-blue-100 text-panda-blue px-3 py-1.5 rounded-full text-sm font-semibold">${item}</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 mb-3 text-lg">Cultural Items (Add what applies to your family):</p>
                            <div class="flex flex-wrap gap-2">
                                ${['PRAYER RUG', 'ALTAR', 'SHRINE', 'TAPESTRY', 'HAMMOCK', 'FLOOR CUSHIONS', 'KOTATSU', 'FUTON', 'DIWAN', 'TRADITIONAL ART', 'INCENSE HOLDER', 'PRAYER BEADS', 'DREAMCATCHER', 'IKEBANA'].map(item => `<span class="bg-orange-100 text-panda-orange px-3 py-1.5 rounded-full text-sm font-semibold">${item}</span>`).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Bedroom -->
                    <div class="bg-white rounded-2xl p-6 border-2 border-gray-300 mb-6">
                        <h3 class="text-2xl font-bold text-panda-blue mb-4">üõèÔ∏è Bedroom</h3>
                        <p class="text-gray-700 mb-4">Personal spaces for rest and daily routines:</p>
                        <div class="mb-5">
                            <p class="font-semibold text-gray-800 mb-3 text-lg">Common Items to Label:</p>
                            <div class="flex flex-wrap gap-2">
                                ${['BED', 'PILLOW', 'BLANKET', 'SHEET', 'COMFORTER', 'DRESSER', 'CLOSET', 'DOOR', 'WINDOW', 'CURTAINS', 'LIGHT', 'LAMP', 'MIRROR', 'CLOCK', 'CLOTHES', 'SHIRT', 'PANTS', 'SHOES', 'SOCKS', 'TOYS', 'BOOKS', 'NIGHTSTAND', 'HAMPER', 'HANGER'].map(item => `<span class="bg-blue-100 text-panda-blue px-3 py-1.5 rounded-full text-sm font-semibold">${item}</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 mb-3 text-lg">Cultural Items (Add what applies to your family):</p>
                            <div class="flex flex-wrap gap-2">
                                ${['FUTON', 'TATAMI MAT', 'MOSQUITO NET', 'DREAMCATCHER', 'PRAYER MAT', 'TRADITIONAL QUILT', 'FLOOR MATTRESS'].map(item => `<span class="bg-orange-100 text-panda-orange px-3 py-1.5 rounded-full text-sm font-semibold">${item}</span>`).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Bathroom -->
                    <div class="bg-white rounded-2xl p-6 border-2 border-gray-300 mb-6">
                        <h3 class="text-2xl font-bold text-panda-blue mb-4">üöø Bathroom</h3>
                        <p class="text-gray-700 mb-4">Self-care spaces where children learn hygiene routines:</p>
                        <div class="mb-5">
                            <p class="font-semibold text-gray-800 mb-3 text-lg">Common Items to Label:</p>
                            <div class="flex flex-wrap gap-2">
                                ${['TOILET', 'SINK', 'BATHTUB', 'SHOWER', 'FAUCET', 'MIRROR', 'TOWEL', 'WASHCLOTH', 'SOAP', 'SHAMPOO', 'CONDITIONER', 'TOOTHBRUSH', 'TOOTHPASTE', 'BRUSH', 'COMB', 'MEDICINE CABINET', 'TOILET PAPER', 'DRAIN', 'MAT', 'WATER'].map(item => `<span class="bg-blue-100 text-panda-blue px-3 py-1.5 rounded-full text-sm font-semibold">${item}</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 mb-3 text-lg">Cultural Items (Add what applies to your family):</p>
                            <div class="flex flex-wrap gap-2">
                                ${['BIDET', 'LOTA', 'BODNA', 'HAMMAM BOWL', 'TRADITIONAL OILS'].map(item => `<span class="bg-orange-100 text-panda-orange px-3 py-1.5 rounded-full text-sm font-semibold">${item}</span>`).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Tips for Success -->
                    <div class="bg-gradient-to-br from-green-50 to-teal-50 rounded-2xl p-6 border-2 border-green-400">
                        <h3 class="text-2xl font-bold text-panda-blue mb-4">üí° Tips for Success</h3>
                        <div class="grid md:grid-cols-2 gap-3 text-gray-700">
                            <div class="flex items-start gap-2">
                                <span class="text-green-600 font-bold text-lg">‚Ä¢</span>
                                <p><strong>Start small:</strong> Begin with 10-15 labels in one room, then expand.</p>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-600 font-bold text-lg">‚Ä¢</span>
                                <p><strong>Point and read:</strong> Touch labels while saying words during activities.</p>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-600 font-bold text-lg">‚Ä¢</span>
                                <p><strong>Make it interactive:</strong> "Can you find the label that says SPOON?"</p>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-600 font-bold text-lg">‚Ä¢</span>
                                <p><strong>Use large letters:</strong> Uppercase, 1-2 inches tall for easy reading.</p>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-600 font-bold text-lg">‚Ä¢</span>
                                <p><strong>Child's eye level:</strong> Place labels where children can see them.</p>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-600 font-bold text-lg">‚Ä¢</span>
                                <p><strong>Replace worn labels:</strong> Check weekly, replace faded ones.</p>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-600 font-bold text-lg">‚Ä¢</span>
                                <p><strong>Add gradually:</strong> Introduce 3-5 new labels each week.</p>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-600 font-bold text-lg">‚Ä¢</span>
                                <p><strong>Include culture:</strong> Label items unique to your heritage.</p>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-600 font-bold text-lg">‚Ä¢</span>
                                <p><strong>Create zones:</strong> "PLAY AREA," "QUIET CORNER" guide behavior.</p>
                            </div>
                            <div class="flex items-start gap-2">
                                <span class="text-green-600 font-bold text-lg">‚Ä¢</span>
                                <p><strong>Be consistent:</strong> Use labels in daily conversation regularly.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderResources() {
            return `
                <div class="max-w-5xl mx-auto">
                    <div class="mb-6">
                        <h2 class="text-3xl font-bold text-panda-blue mb-3">Community Resources & Support</h2>
                        <p class="text-gray-600 text-lg">Free and low-cost resources to support your family's learning and development</p>
                    </div>

                    <!-- Coming Soon Notice -->
                    <div class="bg-gradient-to-br from-orange-50 to-blue-50 border-2 border-panda-orange rounded-2xl p-8 mb-6">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-panda-orange rounded-full flex items-center justify-center flex-shrink-0">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-panda-blue mb-2">More Resources Coming Soon!</h3>
                                <p class="text-gray-700 leading-relaxed mb-3">
                                    We're building a comprehensive library to support families. Future resources will include:
                                </p>
                                <ul class="space-y-2 text-gray-700">
                                    <li>üèõÔ∏è <strong>Free Museum Access:</strong> Programs offering free admission for low-income families</li>
                                    <li>üìö <strong>Parenting Courses:</strong> No-cost online parenting education programs</li>
                                    <li>üíª <strong>Educational Programs:</strong> Online learning platforms with fee waivers for children</li>
                                    <li>ü§ù <strong>Community Services:</strong> Local resources for families in need</li>
                                    <li>üí∞ <strong>Financial Assistance:</strong> Programs to help with childcare and educational materials</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="bg-blue-50 border-l-4 border-panda-blue rounded-lg p-6">
                        <h4 class="font-semibold text-panda-blue mb-2">Have a resource to suggest?</h4>
                        <p class="text-gray-700 text-sm">
                            If you know of valuable resources that should be included here, please contact us at <a href="mailto:rahiem@unc.edu" class="text-panda-blue underline font-medium">rahiem@unc.edu</a>
                        </p>
                    </div>
                </div>
            `;
        }

        function renderCoachingTips() {
            const tip = coachingTips.find(t => t.day === state.currentDay) || coachingTips[0];
            return `
                <div class="max-w-4xl mx-auto">
                    <div class="mb-6">
                        <div class="inline-block bg-panda-blue text-white px-4 py-2 rounded-full text-sm font-semibold mb-4">
                            Day ${state.currentDay} of 20
                        </div>
                        <h2 class="text-3xl font-bold text-panda-blue mb-4">${tip.title}</h2>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-blue-50 rounded-2xl p-6 border-2 border-panda-light-blue">
                            <h3 class="text-lg font-semibold text-panda-blue mb-3 flex items-center gap-2">
                                <div class="w-5 h-5 text-panda-blue">${icons.brain}</div>
                                The Neuroscience
                            </h3>
                            <p class="text-gray-700 leading-relaxed">${tip.content}</p>
                        </div>

                        <div class="bg-orange-50 rounded-2xl p-6 border-2 border-panda-orange">
                            <h3 class="text-lg font-semibold text-panda-blue mb-3 flex items-center gap-2">
                                <div class="w-5 h-5 text-panda-orange">${icons.checkCircle}</div>
                                Put It Into Practice
                            </h3>
                            <p class="text-gray-700 leading-relaxed">${tip.practicalTip}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderChildTutor() {
            if (!state.currentQuestion) {
                startNewLesson();
                return '<div class="text-center p-8">Loading...</div>';
            }

            return `
                <div class="min-h-screen flex flex-col">
                    <!-- Header -->
                    <div class="bg-panda-orange p-4">
                        <div class="max-w-6xl mx-auto flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <div class="bg-white rounded-full p-2">
                                    <div class="w-6 h-6 text-panda-orange">${icons.brain}</div>
                                </div>
                                <span class="text-white font-semibold">Learning with AI Tutor</span>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="bg-white/20 backdrop-blur-sm rounded-full px-4 py-2 text-white font-semibold">
                                    ‚≠ê ${state.childProgress.correct}/${state.childProgress.total}
                                </div>
                                <button onclick="resetApp()" class="bg-white/20 backdrop-blur-sm p-2 rounded-full hover:bg-white/30 transition-colors">
                                    <div class="w-5 h-5 text-white">${icons.home}</div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="flex-1 flex items-center justify-center p-8">
                        <div class="max-w-4xl w-full">
                            <!-- Question Display -->
                            <div class="bg-white rounded-3xl shadow-2xl p-12 text-center mb-8">
                                <div class="text-9xl mb-8 animate-bounce">${state.currentQuestion.image}</div>
                                <h2 class="text-4xl font-bold text-panda-blue mb-6">
                                    ${state.currentQuestion.question}
                                </h2>
                                
                                ${state.feedback ? `
                                    <div class="text-3xl font-bold mb-6 ${state.feedback.includes('Amazing') || state.feedback.includes('Perfect') || state.feedback.includes('Excellent') || state.feedback.includes('Great') ? 'text-green-600' : 'text-panda-blue'}">
                                        ${state.feedback}
                                    </div>
                                ` : ''}
                            </div>

                            <!-- Interactive Options -->
                            ${renderTutorOptions()}

                            <!-- Voice Input -->
                            <div class="mt-8 text-center">
                                <button onclick="handleVoiceInput()" ${state.isListening ? 'disabled' : ''} class="px-12 py-6 rounded-3xl font-bold text-xl shadow-xl transform transition-all ${
                                    state.isListening
                                        ? 'bg-red-500 text-white animate-pulse'
                                        : 'bg-panda-orange hover:bg-orange-600 text-white hover:scale-105'
                                }">
                                    ${state.isListening ? `<div class="inline-block w-8 h-8 mr-3 align-middle">${icons.mic}</div> Listening...` : `<div class="inline-block w-8 h-8 mr-3 align-middle">${icons.volume}</div> Tap to Speak Your Answer!`}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTutorOptions() {
            if (state.currentQuestion.type === 'color') {
                return `
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        ${['red', 'blue', 'yellow', 'green'].map(color => `
                            <button onclick="handleAnswer('${color}' === '${state.currentQuestion.value}')" class="aspect-square rounded-3xl shadow-xl transform hover:scale-110 transition-all ${
                                color === 'red' ? 'bg-red-500' :
                                color === 'blue' ? 'bg-blue-500' :
                                color === 'yellow' ? 'bg-yellow-400' :
                                'bg-green-500'
                            } hover:shadow-2xl flex items-center justify-center">
                                <span class="text-white text-2xl font-bold capitalize">${color}</span>
                            </button>
                        `).join('')}
                    </div>
                `;
            } else {
                return `
                    <div class="grid grid-cols-3 gap-6">
                        <button onclick="handleAnswer('${state.currentQuestion.value}' === 'circle')" class="aspect-square bg-white rounded-3xl shadow-xl flex items-center justify-center hover:scale-110 transition-all">
                            <div class="w-32 h-32 bg-blue-500 rounded-full"></div>
                        </button>
                        <button onclick="handleAnswer('${state.currentQuestion.value}' === 'square')" class="aspect-square bg-white rounded-3xl shadow-xl flex items-center justify-center hover:scale-110 transition-all">
                            <div class="w-32 h-32 bg-red-500"></div>
                        </button>
                        <button onclick="handleAnswer('${state.currentQuestion.value}' === 'triangle')" class="aspect-square bg-white rounded-3xl shadow-xl flex items-center justify-center hover:scale-110 transition-all">
                            <div style="width: 0; height: 0; border-left: 64px solid transparent; border-right: 64px solid transparent; border-bottom: 110px solid #FBBF24;"></div>
                        </button>
                    </div>
                `;
            }
        }

        // ============================================================================
        // EVENT HANDLERS
        // ============================================================================
        function showConsent() {
            state.currentView = 'consent';
            render();
        }

        function backToOpening() {
            state.currentView = 'opening';
            render();
        }

        let consentScrolled = false;
        function handleConsentScroll(e) {
            const bottom = e.target.scrollHeight - e.target.scrollTop <= e.target.clientHeight + 50;
            if (bottom && !consentScrolled) {
                consentScrolled = true;
                document.getElementById('scrollWarning').style.display = 'none';
                document.getElementById('consentCheckbox').disabled = false;
            }
        }

        function updateConsentButton() {
            const checkbox = document.getElementById('consentCheckbox');
            const button = document.getElementById('consentButton');
            if (checkbox.checked) {
                button.disabled = false;
                button.className = 'flex-1 px-6 py-3 rounded-xl font-semibold transition-all bg-panda-blue hover:bg-blue-800 text-white transform hover:scale-105';
            } else {
                button.disabled = true;
                button.className = 'flex-1 px-6 py-3 rounded-xl font-semibold transition-all bg-gray-300 text-gray-500 cursor-not-allowed';
            }
        }

        function acceptConsent() {
            state.consentGiven = true;
            state.userId = `PANDA_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            logInteraction('consent_accepted', { userId: state.userId });
            state.currentView = 'roleSelection';
            render();
        }

        function selectRole(role) {
            state.userRole = role;
            logInteraction('role_selected', { role });
            if (role === 'parent') {
                state.currentView = 'parentDashboard';
            } else {
                // Child role - show child management
                state.currentView = 'childManagement';
            }
            render();
        }

        function resetApp() {
            state.userRole = null;
            state.currentView = 'roleSelection';
            render();
        }

        // ============================================================================
        // CHILD MANAGEMENT SYSTEM
        // ============================================================================
        function renderChildManagement() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 p-8">
                    <div class="max-w-6xl mx-auto">
                        <div class="flex justify-between items-center mb-8">
                            <h1 class="text-5xl font-bold text-panda-blue">üë∂ My Children</h1>
                            <button onclick="resetApp()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-colors">
                                ‚Üê Back to Home
                            </button>
                        </div>

                        ${state.children.length === 0 ? `
                            <div class="text-center mb-12">
                                <p class="text-2xl text-gray-600 mb-8">Add your first child to begin learning!</p>
                            </div>
                        ` : `
                            <div class="text-center mb-12">
                                <p class="text-xl text-gray-600">Select a child to continue learning, or add another child (maximum 5)</p>
                            </div>
                        `}

                        ${state.children.length < 5 ? `
                            <div class="bg-white rounded-3xl shadow-xl p-8 mb-8">
                                <h3 class="text-2xl font-bold text-panda-blue mb-6">Add a Child</h3>
                                <div class="flex gap-4">
                                    <input 
                                        type="text" 
                                        id="childNameInput" 
                                        placeholder="Enter child's name..."
                                        class="flex-1 px-6 py-4 border-2 border-gray-300 rounded-xl text-lg focus:border-panda-blue focus:outline-none"
                                        onkeypress="if(event.key === 'Enter') addChild()"
                                    />
                                    <button onclick="addChild()" class="px-8 py-4 bg-panda-blue text-white rounded-xl text-lg font-semibold hover:bg-blue-800 transition-colors whitespace-nowrap">
                                        + Add Child
                                    </button>
                                </div>
                            </div>
                        ` : `
                            <div class="bg-orange-50 border-2 border-panda-orange rounded-2xl p-6 mb-8 text-center">
                                <p class="text-lg text-gray-700">Maximum of 5 children reached. Remove a child to add another.</p>
                            </div>
                        `}

                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${state.children.map((child, index) => `
                                <div class="bg-white rounded-2xl shadow-lg p-6 border-2 border-panda-light-blue hover:shadow-xl transition-shadow">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 class="text-2xl font-bold text-panda-blue mb-2">${child.name}</h3>
                                            <p class="text-sm text-gray-600">Added ${new Date(child.dateAdded).toLocaleDateString()}</p>
                                        </div>
                                        <button onclick="removeChild('${child.id}')" class="text-red-500 hover:text-red-700 p-2">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    
                                    ${child.preAssessmentComplete ? `
                                        <div class="mb-4">
                                            <div class="flex items-center gap-2 text-green-600 mb-2">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span class="font-semibold">Assessment Complete</span>
                                            </div>
                                            <div class="text-sm text-gray-600">Progress: ${calculateProgress(child.id)}% mastered</div>
                                        </div>
                                    ` : `
                                        <div class="mb-4 text-panda-orange font-semibold">
                                            ‚ö†Ô∏è Pre-assessment needed
                                        </div>
                                    `}
                                    
                                    <button onclick="selectChild('${child.id}')" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-xl font-semibold hover:from-purple-600 hover:to-pink-600 transition-colors">
                                        ${child.preAssessmentComplete ? 'Continue Learning ‚Üí' : 'Start Assessment ‚Üí'}
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function addChild() {
            const input = document.getElementById('childNameInput');
            const name = input.value.trim();
            
            if (!name) {
                alert('Please enter a name for your child.');
                return;
            }
            
            if (state.children.length >= 5) {
                alert('Maximum of 5 children reached.');
                return;
            }
            
            const childId = `child_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            
            const newChild = {
                id: childId,
                name: name,
                dateAdded: new Date().toISOString(),
                preAssessmentComplete: false,
                postAssessmentComplete: false
            };
            
            state.children.push(newChild);
            state.learningData[childId] = initializeLearningData();
            
            logInteraction('child_added', { childId, name });
            input.value = '';
            render();
        }

        function removeChild(childId) {
            const child = state.children.find(c => c.id === childId);
            if (confirm(`Remove ${child.name} from the program?`)) {
                state.children = state.children.filter(c => c.id !== childId);
                delete state.learningData[childId];
                logInteraction('child_removed', { childId });
                render();
            }
        }

        function selectChild(childId) {
            state.activeChildId = childId;
            const child = state.children.find(c => c.id === childId);
            
            if (!child.preAssessmentComplete) {
                state.currentView = 'assessment';
                state.assessmentType = 'pre';
                state.assessmentInProgress = true;
                startAssessment();
            } else {
                state.currentView = 'childLearning';
            }
            render();
        }

        function initializeLearningData() {
            const data = {};
            
            Object.keys(curriculum).forEach(subject => {
                data[subject] = {};
                if (subject === 'opposites') {
                    curriculum[subject].pairs.forEach(pair => {
                        const key = `${pair.a}/${pair.b}`;
                        data[subject][key] = {
                            attempts: 0,
                            correct: 0,
                            incorrect: 0,
                            consecutiveCorrect: 0,
                            mastered: false,
                            lastAttempt: null
                        };
                    });
                } else {
                    curriculum[subject].items.forEach(item => {
                        data[subject][item] = {
                            attempts: 0,
                            correct: 0,
                            incorrect: 0,
                            consecutiveCorrect: 0,
                            mastered: false,
                            lastAttempt: null
                        };
                    });
                }
            });
            
            return data;
        }

        function calculateProgress(childId) {
            const data = state.learningData[childId];
            if (!data) return 0;
            
            let totalItems = 0;
            let masteredItems = 0;
            
            Object.keys(data).forEach(subject => {
                Object.keys(data[subject]).forEach(item => {
                    totalItems++;
                    if (data[subject][item].mastered) {
                        masteredItems++;
                    }
                });
            });
            
            return totalItems > 0 ? Math.round((masteredItems / totalItems) * 100) : 0;
        }

        // ============================================================================
        // ASSESSMENT SYSTEM
        // ============================================================================
        function startAssessment() {
            const assessmentItems = [];
            const distribution = { colors: 7, shapes: 6, numbers: 7 };
            
            Object.keys(distribution).forEach(subject => {
                const items = [...curriculum[subject].items];
                for (let i = 0; i < distribution[subject] && items.length > 0; i++) {
                    const randomIndex = Math.floor(Math.random() * items.length);
                    assessmentItems.push({
                        subject: subject,
                        item: items.splice(randomIndex, 1)[0]
                    });
                }
            });
            
            for (let i = assessmentItems.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [assessmentItems[i], assessmentItems[j]] = [assessmentItems[j], assessmentItems[i]];
            }
            
            state.currentAssessment = {
                items: assessmentItems,
                currentIndex: 0,
                responses: []
            };
        }

        function renderAssessment() {
            if (!state.currentAssessment) startAssessment();
            
            const assessment = state.currentAssessment;
            const currentItem = assessment.items[assessment.currentIndex];
            const child = state.children.find(c => c.id === state.activeChildId);
            const progress = ((assessment.currentIndex / assessment.items.length) * 100);
            
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center p-8">
                    <div class="max-w-4xl w-full">
                        <div class="bg-white rounded-3xl shadow-2xl p-12">
                            <div class="text-center mb-8">
                                <h2 class="text-3xl font-bold text-panda-blue mb-2">${child.name}'s Assessment</h2>
                                <p class="text-gray-600 mb-4">Question ${assessment.currentIndex + 1} of ${assessment.items.length}</p>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-full transition-all" style="width: ${progress}%"></div>
                                </div>
                            </div>
                            <div class="text-center mb-8">
                                ${renderAssessmentItem(currentItem)}
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-gray-800 mb-6">What is this?</p>
                                <div class="flex gap-4 justify-center">
                                    <button onclick="recordAssessmentAnswer(true)" class="px-12 py-6 bg-green-500 text-white rounded-2xl text-2xl font-bold hover:bg-green-600 transition-colors shadow-lg">‚úì Correct</button>
                                    <button onclick="recordAssessmentAnswer(false)" class="px-12 py-6 bg-red-500 text-white rounded-2xl text-2xl font-bold hover:bg-red-600 transition-colors shadow-lg">‚úó Incorrect</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAssessmentItem(item) {
            if (item.subject === 'colors') {
                const colors = {red:'#EF4444',orange:'#F97316',yellow:'#EAB308',green:'#22C55E',blue:'#3B82F6',purple:'#A855F7',black:'#000',white:'#FFF',gray:'#6B7280',brown:'#92400E'};
                return `<div class="w-64 h-64 mx-auto rounded-3xl shadow-2xl" style="background-color:${colors[item.item]};${item.item==='white'?'border:4px solid #E5E7EB;':''}"></div>`;
            } else if (item.subject === 'shapes') {
                const shapes = {
                    circle: '<div class="w-64 h-64 bg-blue-500 rounded-full mx-auto shadow-2xl"></div>',
                    square: '<div class="w-64 h-64 bg-red-500 mx-auto shadow-2xl"></div>',
                    rectangle: '<div class="w-80 h-48 bg-green-500 mx-auto shadow-2xl"></div>',
                    triangle: '<div style="width:0;height:0;border-left:128px solid transparent;border-right:128px solid transparent;border-bottom:220px solid #EAB308;margin:0 auto;"></div>',
                    sphere: '<div class="w-64 h-64 rounded-full mx-auto shadow-2xl" style="background:radial-gradient(circle at 30% 30%,#93C5FD,#1E40AF);"></div>',
                    oval: '<div class="w-80 h-48 bg-purple-500 rounded-full mx-auto shadow-2xl"></div>',
                    star: '<div class="text-9xl">‚≠ê</div>',
                    heart: '<div class="text-9xl">‚ù§Ô∏è</div>'
                };
                return shapes[item.item] || '';
            } else if (item.subject === 'numbers') {
                return `<div class="text-9xl font-bold text-panda-blue">${item.item}</div>`;
            }
            return '';
        }

        function recordAssessmentAnswer(isCorrect) {
            const assessment = state.currentAssessment;
            assessment.responses.push({...assessment.items[assessment.currentIndex], correct: isCorrect});
            
            if (assessment.currentIndex < assessment.items.length - 1) {
                assessment.currentIndex++;
                render();
            } else {
                completeAssessment();
            }
        }

        function completeAssessment() {
            const child = state.children.find(c => c.id === state.activeChildId);
            const assessment = state.currentAssessment;
            const correct = assessment.responses.filter(r => r.correct).length;
            const score = Math.round((correct / assessment.responses.length) * 100);
            
            child.preAssessmentComplete = true;
            child.preAssessmentScore = score;
            
            alert(`Assessment Complete!\n\n${child.name} scored ${score}%\n\nLet's start learning!`);
            
            state.currentAssessment = null;
            state.currentView = 'childLearning';
            render();
        }

        // ============================================================================
        // CHILD LEARNING INTERFACE
        // ============================================================================
        function renderChildLearning() {
            const child = state.children.find(c => c.id === state.activeChildId);
            const progress = calculateProgress(state.activeChildId);
            
            return `
                <div class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 p-8">
                    <div class="max-w-7xl mx-auto">
                        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h1 class="text-3xl font-bold text-panda-blue">${child.name}'s Learning</h1>
                                    <p class="text-gray-600">Overall: ${progress}% Mastered</p>
                                </div>
                                <button onclick="state.currentView='childManagement'; render();" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300">‚Üê Back</button>
                            </div>
                        </div>

                        ${!state.currentSubject ? `
                            <!-- Parent as Teacher Introduction -->
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6 mb-6 border-2 border-blue-300">
                                <div class="flex items-start gap-4">
                                    <div class="text-5xl">üë®‚Äçüè´</div>
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-blue-800 mb-2">Parent as Teacher Mode Available!</h3>
                                        <p class="text-gray-700 mb-3">When you start practicing, you'll see:</p>
                                        <ul class="space-y-2 text-sm text-gray-700">
                                            <li class="flex items-start gap-2">
                                                <span class="text-blue-600 font-bold">‚úì</span>
                                                <span><strong>Step-by-step teaching prompts</strong> - Exactly what to say and do</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <span class="text-blue-600 font-bold">‚úì</span>
                                                <span><strong>Voice guidance</strong> - Click "Voice On" to hear prompts read aloud</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <span class="text-blue-600 font-bold">‚úì</span>
                                                <span><strong>Helpful hints</strong> - Scaffolding tips when your child struggles</span>
                                            </li>
                                            <li class="flex items-start gap-2">
                                                <span class="text-blue-600 font-bold">‚úì</span>
                                                <span><strong>Voice commands</strong> - Say "help", "correct", or "incorrect" hands-free</span>
                                            </li>
                                        </ul>
                                        <p class="text-sm text-gray-600 mt-3 italic">üí° Tip: Try turning on Voice for the full guided experience!</p>
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        <div class="grid md:grid-cols-3 lg:grid-cols-4 gap-6 mb-8">
                            ${['colors','shapes','numbers','letters','clothing','household','animals','opposites'].map(s => renderSubjectCard(s, ['colors','shapes','numbers'].includes(s))).join('')}
                        </div>
                        ${state.currentSubject ? renderSubjectPractice() : ''}
                    </div>
                </div>
            `;
        }

        function renderSubjectCard(subject, isActive) {
            const subjectData = curriculum[subject];
            if (!isActive) {
                return `<div class="bg-gray-100 rounded-2xl p-6 opacity-60 text-center"><div class="text-5xl mb-3">${subjectData.icon}</div><h3 class="text-xl font-bold text-gray-600">${subjectData.name}</h3><p class="text-sm text-gray-500 mt-2">Coming Soon</p></div>`;
            }
            
            const childData = state.learningData[state.activeChildId][subject];
            let mastered = 0, total = 0;
            Object.keys(childData).forEach(item => {total++; if(childData[item].mastered) mastered++;});
            const percentage = total > 0 ? Math.round((mastered / total) * 100) : 0;
            
            return `
                <button onclick="selectSubject('${subject}')" class="bg-white rounded-2xl p-6 border-2 border-panda-light-blue hover:border-panda-blue hover:shadow-xl transition-all">
                    <div class="text-center mb-4">
                        <div class="text-5xl mb-3">${subjectData.icon}</div>
                        <h3 class="text-xl font-bold text-panda-blue">${subjectData.name}</h3>
                    </div>
                    <div class="mb-2">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-gray-600">Progress</span>
                            <span class="font-semibold text-panda-blue">${percentage}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-gradient-to-r from-green-400 to-green-600 h-full" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 text-center">${mastered}/${total} mastered</p>
                </button>
            `;
        }

        function selectSubject(subject) {
            state.currentSubject = subject;
            state.currentLesson = null;
            render();
        }

        function renderSubjectPractice() {
            const subject = state.currentSubject;
            const subjectData = curriculum[subject];
            const childData = state.learningData[state.activeChildId][subject];
            
            const items = Object.keys(childData).filter(item => !childData[item].mastered);
            if (items.length === 0) {
                return `<div class="bg-green-50 border-2 border-green-400 rounded-2xl p-8 text-center"><div class="text-6xl mb-4">üéâ</div><h3 class="text-2xl font-bold text-green-700 mb-2">All Mastered!</h3><button onclick="state.currentSubject=null; render();" class="px-6 py-3 bg-panda-blue text-white rounded-xl font-semibold">Choose Another Subject</button></div>`;
            }
            
            const currentItem = state.currentLesson || items[0];
            const itemData = childData[currentItem];
            const teachingPrompt = teachingGuides[subject]?.prompts[currentItem];
            
            // Generate 3 multiple choice options
            const allItems = curriculum[subject].items || (subject === 'opposites' ? curriculum[subject].pairs.map(p => `${p.a}/${p.b}`) : []);
            const otherItems = allItems.filter(item => item !== currentItem);
            const incorrectOptions = [];
            while (incorrectOptions.length < 2 && otherItems.length > 0) {
                const randomIndex = Math.floor(Math.random() * otherItems.length);
                incorrectOptions.push(otherItems.splice(randomIndex, 1)[0]);
            }
            
            const options = [currentItem, ...incorrectOptions].sort(() => Math.random() - 0.5);
            
            return `
                <div class="bg-white rounded-2xl p-8 shadow-xl">
                    <!-- Header with Controls -->
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-panda-blue">Practice: ${subjectData.name}</h3>
                        <div class="flex gap-2">
                            <button onclick="toggleVoice()" class="px-4 py-2 rounded-xl font-semibold transition-colors ${state.voiceEnabled ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700'}">
                                ${state.voiceEnabled ? 'üîä Voice On' : 'üîá Voice Off'}
                            </button>
                            <button onclick="toggleTeacherMode()" class="px-4 py-2 rounded-xl font-semibold transition-colors ${state.teacherMode ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'}">
                                ${state.teacherMode ? 'üë®‚Äçüè´ Guide On' : 'üë§ Guide Off'}
                            </button>
                            <button onclick="state.currentSubject=null; render();" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300">Back</button>
                        </div>
                    </div>

                    ${state.teacherMode && teachingPrompt ? `
                        <!-- Parent Teaching Guide -->
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 mb-6 border-2 border-purple-200">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-xl font-bold text-purple-700 flex items-center gap-2">
                                    üë®‚Äçüè´ Parent Guide: Teaching "${currentItem}"
                                </h4>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="bg-white rounded-xl p-4">
                                    <p class="font-bold text-purple-700 mb-2">1Ô∏è‚É£ Say to Your Child:</p>
                                    <p class="text-gray-800 text-lg">"${teachingPrompt.say}"</p>
                                    <button onclick="speakText('${teachingPrompt.say.replace(/'/g, "\\'")}');" class="text-sm text-purple-600 hover:text-purple-800 mt-2 px-3 py-1 bg-purple-100 rounded-lg">üîä Play Audio</button>
                                </div>
                                
                                <div class="bg-white rounded-xl p-4">
                                    <p class="font-bold text-blue-700 mb-2">2Ô∏è‚É£ Point & Show:</p>
                                    <p class="text-gray-800">${teachingPrompt.show}</p>
                                </div>
                                
                                <div class="bg-yellow-50 rounded-xl p-4 border-2 border-yellow-300">
                                    <p class="font-bold text-yellow-800 mb-2">üí° Tips:</p>
                                    <p class="text-gray-700 text-sm">${teachingPrompt.tips}</p>
                                </div>
                                
                                ${itemData.incorrect > 1 ? `
                                    <div class="bg-orange-50 rounded-xl p-4 border-2 border-orange-300">
                                        <p class="font-bold text-orange-800 mb-2">üÜò Helpful Hints:</p>
                                        <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
                                            ${teachingPrompt.hints.map(hint => `<li>${hint}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Question -->
                    <div class="text-center mb-8">
                        <h2 class="text-4xl font-bold text-gray-800 mb-6">
                            ${subject === 'colors' ? `Which one is <span class="text-panda-blue">${currentItem.toUpperCase()}</span>?` : 
                              subject === 'shapes' ? `Which one is a <span class="text-panda-blue">${currentItem.toUpperCase()}</span>?` : 
                              `Which one is <span class="text-panda-blue">${currentItem}</span>?`}
                        </h2>
                        <p class="text-gray-600 mb-8">Click on the correct answer:</p>
                    </div>

                    <!-- Multiple Choice Options -->
                    <div class="grid grid-cols-3 gap-6 mb-8 max-w-4xl mx-auto">
                        ${options.map((option, index) => `
                            <button onclick="selectAnswer('${option}')" class="bg-white border-4 border-gray-300 rounded-2xl p-6 hover:border-panda-blue hover:shadow-xl transition-all transform hover:scale-105">
                                ${renderLearningOption(subject, option)}
                                <p class="text-center text-lg font-bold text-gray-700 mt-4">Option ${index + 1}</p>
                            </button>
                        `).join('')}
                    </div>

                    <!-- Progress Indicator -->
                    <div class="bg-gray-50 rounded-xl p-6 max-w-2xl mx-auto">
                        <div class="flex items-center justify-between mb-4">
                            <p class="text-lg font-semibold text-gray-700">Progress to Master "${currentItem}":</p>
                            <p class="text-sm text-gray-600">${itemData.attempts} attempts so far</p>
                        </div>
                        <div class="flex gap-3 justify-center">
                            ${Array.from({length: 3}, (_, i) => `
                                <div class="flex flex-col items-center">
                                    <div class="w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold ${i < itemData.consecutiveCorrect ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-400'}">
                                        ${i < itemData.consecutiveCorrect ? '‚úì' : (i + 1)}
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">${i < itemData.consecutiveCorrect ? 'Done!' : 'Needed'}</p>
                                </div>
                            `).join('')}
                        </div>
                        <p class="text-center text-sm text-gray-600 mt-4">
                            ${itemData.consecutiveCorrect === 0 ? 'Need 3 correct in a row to master!' : 
                              itemData.consecutiveCorrect === 1 ? 'üéâ Great! 2 more in a row!' : 
                              'üåü Almost there! Just 1 more!'}
                        </p>
                    </div>

                    <!-- Voice Help Button -->
                    ${state.voiceEnabled ? `
                        <div class="text-center mt-6">
                            <button onclick="askForHelp()" class="px-6 py-3 bg-blue-500 text-white rounded-xl font-semibold hover:bg-blue-600 transition-colors">
                                üé§ Need Help? (Parent can ask)
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderLearningOption(subject, item) {
            if (subject === 'colors') {
                // Real-world objects for each color
                const colorImages = {
                    red: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjRUY0NDQ0Ii8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42OPC90ZXh0Pjwvc3ZnPg==',
                    orange: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjRjk3MzE2Ii8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42KPC90ZXh0Pjwvc3ZnPg==',
                    yellow: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjRUFCMzA4Ii8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42LPC90ZXh0Pjwvc3ZnPg==',
                    green: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjMjJDNTVFIi8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42MPC90ZXh0Pjwvc3ZnPg==',
                    blue: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjM0I4MkY2Ii8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5qXPC90ZXh0Pjwvc3ZnPg==',
                    purple: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSIjQTg1NUY3Ii8+PHRleHQgeD0iMTAwIiB5PSIxMTUiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42HPC90ZXh0Pjwvc3ZnPg==',
                    black: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTE1IiBmb250LXNpemU9IjQ4IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+lvTwvdGV4dD48L3N2Zz4=',
                    white: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI0ZGRkZGRiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiLz48dGV4dCB4PSIxMDAiIHk9IjExNSIgZm9udC1zaXplPSI0OCIgZmlsbD0iYmxhY2siIHRleHQtYW5jaG9yPSJtaWRkbGUiPuKYgTwvdGV4dD48L3N2Zz4=',
                    gray: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzZCNzI4MCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTE1IiBmb250LXNpemU9IjQ4IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+QmDwvdGV4dD48L3N2Zz4=',
                    brown: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzkyNDAwRSIvPjx0ZXh0IHg9IjEwMCIgeT0iMTE1IiBmb250LXNpemU9IjQ4IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+ngTwvdGV4dD48L3N2Zz4='
                };
                return `<img src="${colorImages[item]}" alt="${item}" class="w-full h-48 object-contain rounded-xl" />`;
            } else if (subject === 'shapes') {
                const shapes = {
                    circle: '<div class="w-32 h-32 bg-blue-500 rounded-full mx-auto"></div>',
                    square: '<div class="w-32 h-32 bg-red-500 mx-auto"></div>',
                    rectangle: '<div class="w-40 h-24 bg-green-500 mx-auto"></div>',
                    triangle: '<div style="width:0;height:0;border-left:64px solid transparent;border-right:64px solid transparent;border-bottom:110px solid #EAB308;margin:0 auto;"></div>',
                    sphere: '<div class="w-32 h-32 rounded-full mx-auto" style="background:radial-gradient(circle at 30% 30%,#93C5FD,#1E40AF);"></div>',
                    oval: '<div class="w-40 h-24 bg-purple-500 rounded-full mx-auto"></div>',
                    star: '<div class="text-8xl text-yellow-400 text-center">‚≠ê</div>',
                    heart: '<div class="text-8xl text-red-500 text-center">‚ù§Ô∏è</div>'
                };
                return shapes[item] || '';
            } else if (subject === 'numbers') {
                return `<div class="text-8xl font-bold text-panda-blue text-center">${item}</div>`;
            }
            return '';
        }

        function selectAnswer(selectedItem) {
            const subject = state.currentSubject;
            const items = Object.keys(state.learningData[state.activeChildId][subject]).filter(i => !state.learningData[state.activeChildId][subject][i].mastered);
            const correctItem = state.currentLesson || items[0];
            
            const isCorrect = selectedItem === correctItem;
            checkAnswer(isCorrect);
        }

        function askForHelp() {
            const subject = state.currentSubject;
            const items = Object.keys(state.learningData[state.activeChildId][subject]).filter(i => !state.learningData[state.activeChildId][subject][i].mastered);
            const item = state.currentLesson || items[0];
            const teachingPrompt = teachingGuides[subject]?.prompts[item];
            
            if (teachingPrompt) {
                speakText(`Here's how to teach ${item}. ${teachingPrompt.tips}`);
            }
        }
            const subject = state.currentSubject;
            const subjectData = curriculum[subject];
            const childData = state.learningData[state.activeChildId][subject];
            
            const items = Object.keys(childData).filter(item => !childData[item].mastered);
            if (items.length === 0) {
                return `<div class="bg-green-50 border-2 border-green-400 rounded-2xl p-8 text-center"><div class="text-6xl mb-4">üéâ</div><h3 class="text-2xl font-bold text-green-700 mb-2">All Mastered!</h3><button onclick="state.currentSubject=null; render();" class="px-6 py-3 bg-panda-blue text-white rounded-xl font-semibold">Choose Another Subject</button></div>`;
            }
            
            const currentItem = state.currentLesson || items[0];
            const itemData = childData[currentItem];
            const teachingPrompt = teachingGuides[subject]?.prompts[currentItem];
            
            return `
                <div class="bg-white rounded-2xl p-8 shadow-xl">
                    <!-- Header with Controls -->
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-panda-blue">Practice: ${subjectData.name}</h3>
                        <div class="flex gap-2">
                            <!-- Voice Toggle -->
                            <button onclick="toggleVoice()" class="px-4 py-2 rounded-xl font-semibold transition-colors ${state.voiceEnabled ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700'}">
                                ${state.voiceEnabled ? 'üîä Voice On' : 'üîá Voice Off'}
                            </button>
                            <!-- Teacher Mode Toggle -->
                            <button onclick="toggleTeacherMode()" class="px-4 py-2 rounded-xl font-semibold transition-colors ${state.teacherMode ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'}">
                                ${state.teacherMode ? 'üë®‚Äçüè´ Teacher Mode' : 'üë§ Free Mode'}
                            </button>
                            <button onclick="state.currentSubject=null; render();" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300">Back</button>
                        </div>
                    </div>

                    ${state.teacherMode && teachingPrompt ? `
                        <!-- Parent Teaching Guide -->
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 mb-6 border-2 border-purple-200">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-xl font-bold text-purple-700 flex items-center gap-2">
                                    üë®‚Äçüè´ Parent Guide: Teaching "${currentItem}"
                                </h4>
                                ${state.voiceEnabled ? `
                                    <button onclick="speakPrompt('show')" class="px-3 py-1 bg-purple-500 text-white rounded-lg text-sm hover:bg-purple-600">
                                        üîä Read Aloud
                                    </button>
                                ` : ''}
                            </div>
                            
                            <div class="space-y-3">
                                <div class="bg-white rounded-xl p-4">
                                    <p class="font-bold text-purple-700 mb-2">1Ô∏è‚É£ Show & Point:</p>
                                    <p class="text-gray-800">${teachingPrompt.show}</p>
                                    ${state.voiceEnabled ? `<button onclick="speakPrompt('show')" class="text-sm text-purple-600 hover:text-purple-800 mt-1">üîä Speak this</button>` : ''}
                                </div>
                                
                                <div class="bg-white rounded-xl p-4">
                                    <p class="font-bold text-blue-700 mb-2">2Ô∏è‚É£ Say Together:</p>
                                    <p class="text-gray-800 text-lg">"${teachingPrompt.say}"</p>
                                    ${state.voiceEnabled ? `<button onclick="speakPrompt('say')" class="text-sm text-blue-600 hover:text-blue-800 mt-1">üîä Speak this</button>` : ''}
                                </div>
                                
                                <div class="bg-white rounded-xl p-4">
                                    <p class="font-bold text-green-700 mb-2">3Ô∏è‚É£ Practice:</p>
                                    <p class="text-gray-800">${teachingPrompt.practice}</p>
                                    ${state.voiceEnabled ? `<button onclick="speakPrompt('practice')" class="text-sm text-green-600 hover:text-green-800 mt-1">üîä Speak this</button>` : ''}
                                </div>
                                
                                <div class="bg-yellow-50 rounded-xl p-4 border-2 border-yellow-300">
                                    <p class="font-bold text-yellow-800 mb-2">üí° Teaching Tips:</p>
                                    <p class="text-gray-700 text-sm">${teachingPrompt.tips}</p>
                                </div>
                                
                                ${itemData.consecutiveCorrect === 0 && itemData.incorrect > 0 ? `
                                    <div class="bg-orange-50 rounded-xl p-4 border-2 border-orange-300">
                                        <p class="font-bold text-orange-800 mb-2">üÜò Helpful Hints:</p>
                                        <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
                                            ${teachingPrompt.hints.map(hint => `<li>${hint}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Learning Item Display -->
                    <div class="text-center mb-8">
                        ${renderAssessmentItem({subject, item: currentItem})}
                    </div>

                    <!-- Question and Response -->
                    <div class="text-center">
                        <p class="text-2xl font-bold text-gray-800 mb-6">What is this?</p>
                        
                        <!-- Voice Interaction Button -->
                        ${state.voiceEnabled ? `
                            <div class="mb-6">
                                <button onclick="startVoiceRecognition()" class="px-8 py-4 ${state.isListening ? 'bg-red-500 animate-pulse' : 'bg-blue-500'} text-white rounded-2xl text-lg font-bold hover:opacity-90 transition-all shadow-lg">
                                    ${state.isListening ? 'üé§ Listening...' : 'üé§ Ask for Help'}
                                </button>
                                <p class="text-xs text-gray-500 mt-2">Say "help", "correct", "incorrect", or "next"</p>
                            </div>
                        ` : ''}
                        
                        <!-- Manual Response Buttons -->
                        <div class="flex gap-4 justify-center mb-6">
                            <button onclick="checkAnswer(true)" class="px-12 py-6 bg-green-500 text-white rounded-2xl text-2xl font-bold hover:bg-green-600 shadow-lg transition-colors">‚úì Correct</button>
                            <button onclick="checkAnswer(false)" class="px-12 py-6 bg-red-500 text-white rounded-2xl text-2xl font-bold hover:bg-red-600 shadow-lg transition-colors">‚úó Incorrect</button>
                        </div>
                        
                        <!-- Progress Indicator -->
                        <div class="bg-gray-50 rounded-xl p-4 inline-block">
                            <p class="text-sm text-gray-600 mb-2">Progress for this item:</p>
                            <div class="flex gap-2 items-center justify-center">
                                ${Array.from({length: 3}, (_, i) => `
                                    <div class="w-12 h-12 rounded-full flex items-center justify-center text-xl font-bold ${i < itemData.consecutiveCorrect ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-400'}">
                                        ${i < itemData.consecutiveCorrect ? '‚úì' : (i + 1)}
                                    </div>
                                `).join('')}
                            </div>
                            <p class="text-xs text-gray-500 mt-2">${3 - itemData.consecutiveCorrect} more correct in a row to master!</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function checkAnswer(isCorrect) {
            const subject = state.currentSubject;
            const items = Object.keys(state.learningData[state.activeChildId][subject]).filter(i => !state.learningData[state.activeChildId][subject][i].mastered);
            const item = state.currentLesson || items[0];
            const itemData = state.learningData[state.activeChildId][subject][item];
            
            itemData.attempts++;
            
            if (isCorrect) {
                itemData.correct++;
                itemData.consecutiveCorrect++;
                
                // Voice feedback for correct answers
                if (itemData.consecutiveCorrect >= 3) {
                    itemData.mastered = true;
                    speakText(`Amazing! You mastered ${item}! That's wonderful!`);
                    
                    // Celebration alert
                    setTimeout(() => {
                        alert(`üéâ MASTERED: ${item}!\n\n${state.children.find(c => c.id === state.activeChildId).name} has mastered this item!\n\nGreat teaching!`);
                        state.currentLesson = null;
                        render();
                    }, 100);
                } else {
                    const remaining = 3 - itemData.consecutiveCorrect;
                    speakText(`Correct! Great job! Only ${remaining} more in a row!`);
                }
            } else {
                itemData.incorrect++;
                const previousStreak = itemData.consecutiveCorrect;
                itemData.consecutiveCorrect = 0;
                
                // Scaffolding feedback based on struggle
                if (itemData.incorrect === 1) {
                    speakText(`Not quite. This is ${item}. Let's try again together!`);
                } else if (itemData.incorrect === 2) {
                    speakText(`Let me help you. This is ${item}. Can you say ${item} with me?`);
                    
                    // Show hint if in teacher mode
                    if (state.teacherMode) {
                        const teachingPrompt = teachingGuides[subject]?.prompts[item];
                        if (teachingPrompt && teachingPrompt.hints[0]) {
                            setTimeout(() => {
                                speakText(teachingPrompt.hints[0]);
                            }, 2000);
                        }
                    }
                } else {
                    speakText(`That's okay! Learning takes practice. This is ${item}. Let's keep trying!`);
                }
                
                if (previousStreak > 0) {
                    speakText(`We'll get back to ${previousStreak} in a row. Keep practicing!`);
                }
            }
            
            logInteraction('learning_attempt', {
                childId: state.activeChildId,
                subject: subject,
                item: item,
                correct: isCorrect,
                consecutiveCorrect: itemData.consecutiveCorrect,
                attempts: itemData.attempts,
                mastered: itemData.mastered
            });
            
            render();
        }

        function setActiveTab(tab) {
            state.activeTab = tab;
            render();
        }

        function startNewLesson() {
            const lessons = [
                { type: 'color', value: 'red', question: 'Can you find something RED?', image: 'üçé' },
                { type: 'color', value: 'blue', question: 'Show me something BLUE!', image: 'üíô' },
                { type: 'color', value: 'yellow', question: 'What color is this? YELLOW!', image: 'üåü' },
                { type: 'color', value: 'green', question: 'Can you spot something GREEN?', image: 'üåø' },
                { type: 'shape', value: 'circle', question: 'This is a CIRCLE! Round like a ball!', image: '‚ö™' },
                { type: 'shape', value: 'square', question: 'Look at this SQUARE! It has 4 sides!', image: '‚óªÔ∏è' },
                { type: 'shape', value: 'triangle', question: 'Here is a TRIANGLE! It has 3 pointy corners!', image: 'üî∫' }
            ];
            const randomLesson = lessons[Math.floor(Math.random() * lessons.length)];
            state.currentQuestion = randomLesson;
            state.feedback = '';
            logInteraction('lesson_started', { lesson: randomLesson });
            speakText(randomLesson.question);
        }

        function handleAnswer(isCorrect) {
            state.childProgress.total++;
            if (isCorrect) {
                state.childProgress.correct++;
                const praises = [
                    'Amazing! You did it! üéâ',
                    'Wow! Great job! ‚≠ê',
                    'Perfect! You are so smart! üåü',
                    'Excellent work! üéä',
                    'That is right! High five! ‚úã'
                ];
                const praise = praises[Math.floor(Math.random() * praises.length)];
                state.feedback = praise;
                speakText(praise);
                logInteraction('correct_answer', { lesson: state.currentQuestion });
                
                setTimeout(() => {
                    startNewLesson();
                    render();
                }, 3000);
            } else {
                const encouragements = [
                    'Not quite! Let us try again together! üí™',
                    'That is okay! Let us look closely! üëÄ',
                    'Good try! Want to try once more? üôÇ'
                ];
                const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                state.feedback = encouragement;
                speakText(encouragement);
                logInteraction('incorrect_answer', { lesson: state.currentQuestion });
            }
            render();
        }

        function handleVoiceInput() {
            state.isListening = true;
            render();
            speakText('Tell me your answer!');
            
            setTimeout(() => {
                state.isListening = false;
                const isCorrect = Math.random() > 0.3;
                handleAnswer(isCorrect);
            }, 2000);
        }

        // ============================================================================
        // MAIN RENDER FUNCTION
        // ============================================================================
        function render() {
            const app = document.getElementById('app');
            
            if (state.currentView === 'opening') {
                app.innerHTML = renderOpeningPage();
            } else if (state.currentView === 'consent') {
                app.innerHTML = renderConsentForm();
            } else if (state.currentView === 'roleSelection') {
                app.innerHTML = renderRoleSelection();
            } else if (state.currentView === 'parentDashboard') {
                app.innerHTML = renderParentDashboard();
                
                // Render tab content
                const tabContent = document.getElementById('tabContent');
                if (state.activeTab === 'coaching') {
                    tabContent.innerHTML = renderCoachingTips();
                } else if (state.activeTab === 'labeling') {
                    tabContent.innerHTML = renderLabelingGuide();
                } else if (state.activeTab === 'calendar') {
                    tabContent.innerHTML = '<div class="text-center text-gray-600 p-8 text-lg">üìÖ Learning Calendar - Interactive 20-day calendar coming soon</div>';
                } else if (state.activeTab === 'journal') {
                    tabContent.innerHTML = renderJournal();
                } else if (state.activeTab === 'resources') {
                    tabContent.innerHTML = renderResources();
                } else if (state.activeTab === 'surveys') {
                    tabContent.innerHTML = '<div class="text-center text-gray-600 p-8 text-lg">üìã Surveys - Qualtrics integration ready for deployment</div>';
                } else if (state.activeTab === 'analytics') {
                    tabContent.innerHTML = '<div class="text-center text-gray-600 p-8 text-lg">üìä Analytics - Progress tracking dashboard coming soon</div>';
                }
            } else if (state.currentView === 'childManagement') {
                app.innerHTML = renderChildManagement();
            } else if (state.currentView === 'assessment') {
                app.innerHTML = renderAssessment();
            } else if (state.currentView === 'childLearning') {
                app.innerHTML = renderChildLearning();
            } else if (state.currentView === 'childTutor') {
                app.innerHTML = renderChildTutor();
            }
        }

        // Initialize app
        render();
    </script>
</body>
</html>
